# TSK-03-99 기술 설계서

## 개요

| 항목 | 값 |
|------|-----|
| Task ID | TSK-03-99 |
| Task 제목 | WP-03 및 전체 MVP 통합 검증 |
| Category | infrastructure |
| Domain | test |
| 상태 | 상세설계 `[dd]` |

## 목적

MVP 전체 기능의 통합 테스트를 위한 기술 설계. 모든 Work Package(WP-00 ~ WP-03)의 기능이 정상적으로 연동되어 Notion과 유사한 사용자 경험을 제공하는지 최종 검증 수행.

## 현재 상태

### 구현된 기능

| WP | 기능 | 구현 완료 |
|----|------|----------|
| WP-00 | 프로젝트 초기화 (Next.js, DB, 스토어) | `[xx]` |
| WP-01 | 핵심 에디터 (BlockNote, 헤더, 저장) | `[vf]` |
| WP-02 | 페이지 구조 (사이드바, 트리, 라우팅, 검색) | `[vf]` |
| WP-03 | MVP 완성 (반응형, 다크모드, 에러 처리) | `[ap]` |

### 현재 테스트 상태

| 테스트 유형 | 파일 | 통과율 |
|------------|------|--------|
| E2E (Editor) | `tests/e2e/editor.spec.ts` | 통과 |
| E2E (Layout) | `tests/e2e/layout.spec.ts` | 통과 |
| E2E (Page Header) | `tests/e2e/page-header.spec.ts` | 통과 |
| E2E (Icon Picker) | `tests/e2e/IconPicker.spec.ts` | 통과 |
| E2E (Responsive) | `tests/e2e/responsive-layout.spec.ts` | 통과 |
| E2E (Dark Mode) | `tests/e2e/dark-mode.spec.ts` | 통과 |
| E2E (Search) | `tests/e2e/search.spec.ts` | 통과 |
| E2E (Error/Loading) | `tests/e2e/error-loading-state.spec.ts` | 통과 (TSK-03-03) |

## 목표 상태

### 통합 테스트 범위

전체 MVP 기능을 검증하는 E2E 테스트 시나리오 정의:

#### 시나리오 1: 페이지 생성부터 저장까지
```
1. 애플리케이션 시작 (http://localhost:3002)
2. 사이드바에서 새 페이지 버튼 클릭
3. 페이지 제목 입력 (예: "새로운 페이지")
4. 페이지 아이콘 선택 (이모지)
5. 에디터에서 콘텐츠 작성 (텍스트, 제목, 리스트)
6. 2초 대기 (저장 완료 대기)
7. 새로고침
8. 검증: 제목, 아이콘, 콘텐츠 유지 확인
```

#### 시나리오 2: 페이지 계층 구조 관리
```
1. 첫 페이지 생성 (루트)
2. 하위 페이지 생성 (하위)
3. 하위 페이지 아래에 또 다른 페이지 생성 (깊이 2)
4. 사이드바에서 계층 구조 확인 (들여쓰기)
5. 폴더 토글로 하위 페이지 숨기기/표시
6. 중간 페이지 클릭 → 콘텐츠 확인
7. 최하위 페이지 클릭 → 콘텐츠 확인
```

#### 시나리오 3: 즐겨찾기 기능
```
1. 여러 페이지 생성
2. 각 페이지의 즐겨찾기 버튼 클릭
3. 사이드바 Favorites 섹션 확인
4. Favorites에서 페이지 클릭 → 이동 확인
5. 즐겨찾기 해제 → Favorites에서 제거 확인
```

#### 시나리오 4: 검색 기능
```
1. 여러 페이지 생성 (다양한 제목)
2. Cmd+K 단축키 누름
3. 검색 모달 표시 확인
4. 페이지 제목으로 검색 (예: "테스트")
5. 검색 결과에서 페이지 클릭
6. 검증: 해당 페이지로 이동 확인
```

#### 시나리오 5: 반응형 레이아웃
```
1. 데스크톱 뷰 (1920x1080)에서 앱 접속
2. 사이드바 토글 확인 (240px 고정)
3. 뷰포트 크기 변경 (375x667, 모바일)
4. 검증: 사이드바 오버레이 확인
5. 햄버거 메뉴 클릭 → 사이드바 열기
6. 에디터 영역 확인 (패딩 24px)
7. 바깥 클릭 → 사이드바 닫기
```

#### 시나리오 6: 다크모드
```
1. 시스템 라이트모드에서 앱 접속
2. 배경색 확인 (흰색)
3. 시스템 다크모드 변경
4. 검증: UI가 다크모드로 자동 전환
5. 배경색 확인 (#191919)
6. 텍스트 색상 확인 (#E6E6E4)
```

#### 시나리오 7: 에러 처리
```
1. API 에러 시뮬레이션 (네트워크 오프라인)
2. 페이지 이동 시도
3. 검증: 에러 토스트 표시
4. 네트워크 복구
5. 페이지 새로고침
6. 검증: 정상 로드 확인
```

#### 시나리오 8: 로딩 상태
```
1. 페이지 로딩 지연 시뮬레이션
2. 페이지 이동
3. 검증: 스켈레톤 UI 표시
4. 커버, 아이콘, 제목 스켈레톤 확인
5. 콘텐츠 로드 완료 후 스켈레톤 제거 확인
```

### 검증 기준

| 항목 | 기준 |
|------|------|
| 페이지 생성/저장 | 새 페이지 생성 후 새로고침 시 데이터 유지 |
| 계층 구조 | 중첩 페이지 트리 정상 표시 및 탐색 가능 |
| 즐겨찾기 | 즐겨찾기 추가/제거 및 바로가기 동작 |
| 검색 | Cmd+K로 검색 모달 열고 결과로 이동 |
| 반응형 | 모바일/데스크톱 뷰에서 사이드바 정상 동작 |
| 다크모드 | 시스템 설정에 따른 자동 테마 전환 |
| 에러 처리 | 네트워크 에러 시 토스트 알림 표시 |
| 로딩 상태 | 페이지 로딩 시 스켈레톤 UI 표시 |

## 구현 계획

### Phase 1: 통합 E2E 테스트 파일 생성

1. `tests/e2e/wp03-integration.spec.ts` 생성
   - 시나리오 1~8 구현
   - Playwright API 활용 (page.goto, page.click, page.fill, page.keyboard)
   - data-testid 셀렉터 활용

2. 테스트 환경 설정
   - playwright.config.ts 확인
   - baseURL: http://localhost:3002
   - reuseExistingServer: true

### Phase 2: 테스트 데이터 초기화

테스트 실행 전 DB 초기화 필요:
- SQLite 데이터베이스 파일 삭제
- 또는 테스트용 별도 DB 사용

### Phase 3: 테스트 실행 및 검증

```bash
cd notion-like
npx playwright test tests/e2e/wp03-integration.spec.ts
```

### Phase 4: 테스트 결과서 생성

- `070-integration-test.md` 생성
- 테스트 실행 요약
- 실패 시나리오 및 원인 분석
- 스크린샷 포함

## 의존성

### 선행 Task

| Task ID | 상태 | 의존성 |
|---------|------|---------|
| TSK-03-01 | `[vf]` | 반응형 레이아웃 |
| TSK-03-02 | `[vf]` | 다크모드 지원 |
| TSK-03-03 | `[im]` | 에러 처리 및 로딩 상태 |

### 기술 의존성

| 도구/라이브러리 | 버전 | 용도 |
|---------------|-------|------|
| Playwright | 1.40.0+ | E2E 테스트 |
| Next.js | 15.0.0+ | 웹 프레임워크 |
| BlockNote | 0.18.0+ | 에디터 |
| Zustand | 5.0.0+ | 상태 관리 |

## 위험 요소 및 대응

| 위험 요소 | 영향도 | 대응 방안 |
|----------|--------|----------|
| DB 초기화 미설정 | 중 | 테스트 간 데이터 오염 가능 → beforeEach에서 DB 리셋 |
| 랜덤 페이지 ID | 낮 | E2E 테스트에서 ID 생성 → URL 직접 접근 대신 UI 클릭 사용 |
| 네트워크 속도 | 낮 | CI 환경에서 느린 네트워크 → timeout 적절히 설정 |
| 브라우저 호환성 | 낮 | Chromium에서만 테스트 → Firefox/Safari는 수동 검증 |

## 성공 기준

- [ ] 모든 시나리오(8개)에서 테스트 작성 완료
- [ ] E2E 테스트 실행 완료
- [ ] 전체 시나리오 100% 통과
- [ ] `070-integration-test.md` 작성 완료
- [ ] WP-03 및 전체 MVP 통합 검증 완료

---

<!--
010-tech-design.md
TSK-03-99
Version: 1.0
-->
