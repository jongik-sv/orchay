# 설계 리뷰: WBS 데이터 유효성 검증

## 문서 정보

| 항목 | 내용 |
|------|------|
| Task ID | TSK-02-02-03 |
| 리뷰 유형 | LLM 설계 리뷰 |
| 리뷰 일시 | 2025-12-14 |
| 리뷰어 | Claude |
| 리뷰 대상 문서 | 020-detail-design.md, 025-traceability-matrix.md |

---

## 1. 리뷰 요약

### 1.1 전체 평가

| 검증 영역 | 평가 | 비고 |
|----------|------|------|
| 문서 완전성 | PASS | 17개 섹션, 필수 내용 모두 포함 |
| 요구사항 추적성 | PASS | 27개 요구사항 100% 커버리지 |
| 아키텍처 설계 | PASS | 6개 검증 모듈로 명확한 책임 분리 |
| 보안 고려사항 | PASS | DoS 방지, 입력 제한 |
| 성능 설계 | PASS | O(n) 복잡도, 성능 목표 명확 |
| 테스트 전략 | PASS | 19개 단위 + 5개 통합 테스트 계획 |

### 1.2 이슈 통계

| 심각도 | 개수 |
|--------|------|
| Critical | 0 |
| High | 0 |
| Medium | 2 |
| Low | 3 |
| Info | 2 |

---

## 2. 상세 리뷰 결과

### 2.1 문서 구조 검증

#### 긍정 사항
- Mermaid 다이어그램으로 모듈 구조와 의존성이 시각화됨
- 각 Validator별 메서드 시그니처와 알고리즘이 상세히 정의됨
- 오류 메시지 템플릿이 표로 정리되어 일관성 있는 UX 보장
- 사용 예시(API, 프론트엔드)로 실제 활용 시나리오 제공

#### 개선 필요 사항
없음

---

### 2.2 요구사항 추적성 검증

#### 긍정 사항
- FR 10개, BR 5개, IF 6개, AC 6개 모두 설계에 매핑됨
- 역방향 추적으로 모든 설계 요소가 요구사항에서 유래했음을 검증
- 테스트 케이스와 요구사항 간 1:N 매핑 완료

#### 이슈

| ID | 심각도 | 우선순위 | 이슈 내용 | 권장 조치 |
|----|--------|----------|----------|----------|
| REQ-001 | Info | P5 | 테스트 명세(026-test-specification.md)가 "다음 단계"로 명시되어 있어 아직 미작성 상태 | 구현 전 테스트 명세 문서 작성 필요하나, 추적성 매트릭스에 테스트 ID가 정의되어 있어 구현 가능 |

---

### 2.3 아키텍처 검증

#### 긍정 사항
- 단일 책임 원칙에 따른 5개 Validator 분리
- 서비스-검증-데이터 3계층 아키텍처
- 확장 포인트(CustomValidator, ValidationPlugin)로 향후 확장성 고려

#### 이슈

| ID | 심각도 | 우선순위 | 이슈 내용 | 권장 조치 |
|----|--------|----------|----------|----------|
| ARCH-001 | Medium | P3 | 상태 코드 허용 목록에 `[an]`, `[ds]`, `[fx]`가 포함되어 있으나, 파서 설계(TSK-02-02-01)의 상태 목록과 동기화 여부 불명확 | 파서와 검증기 간 상태 코드 목록을 공통 상수로 분리하여 단일 소스 유지 권장 |
| ARCH-002 | Low | P4 | HierarchyValidator에서 순환 참조 검출이 "최대 깊이 제한(50)"으로만 처리되어 직접적인 검출 로직 없음 | 방문 노드 Set을 사용한 명시적 순환 참조 검출 추가 권장 |

---

### 2.4 보안 검증

#### 긍정 사항
- DoS 방지: 최대 노드 수 10,000개 제한
- 순환 참조 방지: 최대 깊이 50 레벨 제한
- 메모리 공격 방지: 문자열 길이 1,000자 제한
- XSS 방지: 오류 메시지 이스케이프

#### 이슈

| ID | 심각도 | 우선순위 | 이슈 내용 | 권장 조치 |
|----|--------|----------|----------|----------|
| SEC-001 | Low | P5 | 검증 서비스가 권한을 확인하지 않는다고 명시되어 있으나, API 레이어에서의 권한 검증 설계가 다른 Task에 있는지 불명확 | 권한 검증은 API 라우트 미들웨어에서 처리됨을 가정. 실제 구현 시 확인 필요 |

---

### 2.5 성능 검증

#### 긍정 사항
- 성능 목표 명확: 1000 노드 < 200ms
- O(n) 시간/공간 복잡도
- 단일 순회, 정규식 컴파일 캐싱 등 최적화 전략

#### 이슈

| ID | 심각도 | 우선순위 | 이슈 내용 | 권장 조치 |
|----|--------|----------|----------|----------|
| PERF-001 | Info | P5 | Early Return 옵션(첫 오류 시 즉시 반환)이 언급되어 있으나, 실제 인터페이스에서 이 옵션을 어떻게 제공하는지 설계 없음 | 구현 시 `validateWbs(nodes, options?: { failFast?: boolean })` 형태로 옵션 추가 권장 |

---

### 2.6 테스트 전략 검증

#### 긍정 사항
- 긍정/부정/경계 조건 시나리오 분류
- 단위 테스트 → 요구사항 매핑 완료 (19개 케이스)
- 통합 테스트 5개로 전체 흐름 검증

#### 이슈

| ID | 심각도 | 우선순위 | 이슈 내용 | 권장 조치 |
|----|--------|----------|----------|----------|
| TEST-001 | Medium | P3 | 경계 조건 시나리오 EDGE-003("Task만 있는 경우")에서 "계층 오류"가 예상되나, Task가 루트인 경우 HierarchyValidator가 어떻게 처리하는지 설계에 명시되지 않음 | Task 노드가 루트인 경우 부모가 없으므로 계층 검증을 스킵하거나, "Task는 WP/ACT 하위에 있어야 함" 오류 반환 로직 명시 필요 |
| TEST-002 | Low | P4 | 대량 노드 성능 테스트(IT-VAL-005)의 테스트 데이터 생성 방법이 설계에 없음 | 테스트 픽스처 생성 유틸리티 또는 팩토리 함수 추가 권장 |

---

## 3. 설계 품질 메트릭

| 메트릭 | 값 | 평가 |
|--------|-----|------|
| 요구사항 커버리지 | 100% | 우수 |
| 테스트 케이스 수 | 24개 (19+5) | 충분 |
| Validator 모듈 수 | 5개 | 적정 |
| 오류 타입 수 | 6개 | 적정 |

---

## 4. 권장 사항 요약

### 4.1 구현 전 조치 필요 (P3)
1. 상태 코드 허용 목록을 파서/검증기 간 공통 상수로 분리 (ARCH-001)
2. Task 노드가 루트인 경우 처리 로직 명시 (TEST-001)

### 4.2 구현 중 고려 (P4-P5)
1. 명시적 순환 참조 검출 로직 추가
2. 성능 테스트 데이터 생성 유틸리티
3. Early Return 옵션 인터페이스 설계

---

## 5. 파서-검증기 일관성 체크리스트

| 항목 | 파서 설계 | 검증기 설계 | 일관성 |
|------|----------|------------|--------|
| WP ID 패턴 | `WP-\d{2}` | `^WP-\d{2}$` | OK |
| ACT ID 패턴 | `ACT-\d{2}-\d{2}` | `^ACT-\d{2}-\d{2}$` | OK |
| TSK ID (4단계) | `TSK-\d{2}-\d{2}-\d{2}` | `^TSK-\d{2}-\d{2}-\d{2}$` | OK |
| TSK ID (3단계) | `TSK-\d{2}-\d{2}` | `^TSK-\d{2}-\d{2}$` | OK |
| 상태 코드 목록 | (명시 안됨) | 9개 코드 정의 | **확인 필요** |
| category 값 | development, defect, infrastructure | 동일 | OK |
| priority 값 | critical, high, medium, low | 동일 | OK |

---

## 6. 검증 규칙 완전성 체크

| 검증 영역 | 설계된 검증 | 누락된 검증 |
|----------|------------|------------|
| ID 형식 | WP, ACT, TSK 패턴 | 없음 |
| 필수 속성 | category, status, priority | 없음 |
| 상태 코드 | 9개 허용 코드 | 없음 |
| 중복 ID | 전체 트리 스캔 | 없음 |
| 계층 관계 | 부모-자식 접두사 | Task 루트 케이스 |
| 값 범위 | category, priority | schedule 날짜 형식 검증 (선택사항) |

---

## 7. 리뷰 결론

**결과: PASS**

설계 문서가 검증 서비스 구현에 필요한 모든 정보를 포함하고 있습니다. 발견된 이슈들은 Critical/High 수준이 아니므로 구현을 진행할 수 있습니다. Medium 수준 이슈 2건(상태 코드 목록 동기화, Task 루트 처리)은 구현 단계에서 파서 설계를 참조하여 해결하면 됩니다.

구현 우선순위가 설계에 명시되어 있어(IdValidator → DuplicateChecker → AttributeValidator → StatusValidator → HierarchyValidator → WbsValidator 순) 체계적인 구현이 가능합니다.

---

## 8. 변경 이력

| 버전 | 날짜 | 변경 내용 | 리뷰어 |
|------|------|----------|--------|
| 1.0 | 2025-12-14 | 최초 리뷰 | Claude |

---

## 9. 개선사항 적용 결과

**적용일**: 2025-12-14
**적용자**: Claude Opus 4.5
**수정 문서**: `020-detail-design.md`

### 9.1 적용 방침
- ✅ 시스템&Task 적합 → 적용
- 📝 조정 필요 → 수정 적용
- ⏸️ 부적합 → 보류

### 9.2 적용 완료 이슈

#### [ARCH-001] 상태 코드 목록 파서/검증기 간 공통 상수 분리 (P3/Medium)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 파서와 검증기 간 상태 코드 목록을 공통 상수로 분리하여 단일 소스 유지 |
| **적용 방식** | ✅ 그대로 |
| **반영 내용** | `VALID_STATUS_CODES` 공통 상수 정의를 types/index.ts에서 import하도록 명시. category, priority도 동일하게 공통 상수 참조 |
| **수정 섹션** | 4.3 AttributeValidator, 4.4 StatusValidator |
| **적용 사유** | 파서/시리얼라이저/검증기 간 정합성 보장 - 매직 스트링 제거 |

#### [TEST-001] Task 루트 케이스 처리 로직 명시 (P3/Medium)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | Task 노드가 루트인 경우 처리 로직 명시 필요 |
| **적용 방식** | ✅ 그대로 |
| **반영 내용** | HierarchyValidator의 validateHierarchy에 parent=null 케이스 처리 추가. WP만 루트 가능, Task/ACT는 HIERARCHY_MISMATCH 오류 |
| **수정 섹션** | 4.5 HierarchyValidator |
| **적용 사유** | 테스트 시나리오 EDGE-003 커버리지 확보 |

#### [ARCH-002] 명시적 순환 참조 검출 로직 (P4/Low)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 방문 노드 Set을 사용한 명시적 순환 참조 검출 추가 |
| **적용 방식** | ✅ 그대로 |
| **반영 내용** | validateWbs에 visitedSet 기반 순환 참조 검출 알고리즘 추가 |
| **수정 섹션** | 4.1 WbsValidator |
| **적용 사유** | 디버깅 용이성 - 최대 깊이 제한보다 정확한 검출 |

#### [Gemini P3/Low] Task ID 깊이 검증 로직 명확화 (P3/Low)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | validateId에 depth 파라미터 추가 또는 3/4단계 유연 매칭 |
| **적용 방식** | 📝 조정 (둘 다 지원) |
| **반영 내용** | validateId에 `depth?: 3 | 4` 파라미터 추가. depth 지정 시 해당 패턴만, 미지정 시 둘 중 하나라도 매칭되면 통과 |
| **수정 섹션** | 4.2 IdValidator |
| **적용 사유** | 프로젝트 메타데이터 depth 설정 활용 가능, 유연성 확보 |

#### [PERF-001] Early Return 옵션 인터페이스 (P5/Info)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | `validateWbs(nodes, options?: { failFast?: boolean })` 형태로 옵션 추가 |
| **적용 방식** | ✅ 그대로 |
| **반영 내용** | ValidationOptions 인터페이스 추가. `failFast: boolean` 옵션으로 첫 오류 시 즉시 반환 지원 |
| **수정 섹션** | 4.1 WbsValidator |
| **적용 사유** | 성능 최적화 - 대용량 WBS에서 빠른 피드백 가능 |

#### [Gemini P4/Low] Enum 공유 - 매직 스트링 방지 (P4/Low)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | types/index.ts의 Enum 값을 import하여 오타 방지 |
| **적용 방식** | ✅ 그대로 |
| **반영 내용** | validateCategory, validatePriority에 `VALID_CATEGORIES`, `VALID_PRIORITIES` 상수 참조 명시 |
| **수정 섹션** | 4.3 AttributeValidator |
| **적용 사유** | 파서/시리얼라이저와 정합성 유지 |

### 9.3 보류 이슈

#### [REQ-001] 테스트 명세 문서 작성 (P5/Info)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 구현 전 테스트 명세 문서 작성 필요 |
| **보류 사유** | 추적성 매트릭스에 테스트 ID 정의됨, 구현 전 작성 예정 |
| **대안/향후 계획** | 설계 완료 후 026-test-specification.md 작성 |

#### [SEC-001] 권한 검증 API 레이어 확인 (P5/Low)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | API 레이어에서의 권한 검증 설계 확인 |
| **보류 사유** | 검증 서비스 범위 외 - API 라우트 미들웨어에서 처리 |
| **대안/향후 계획** | API 구현 Task에서 미들웨어 권한 검증 확인 |

#### [TEST-002] 대량 노드 테스트 데이터 생성 (P4/Low)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 테스트 픽스처 생성 유틸리티 또는 팩토리 함수 추가 |
| **보류 사유** | 테스트 구현 단계에서 처리 - 설계 문서 범위 외 |
| **대안/향후 계획** | 테스트 명세 작성 시 생성 방법 정의 |

#### [Gemini P5/Info] 상태 코드 확장성 - config 분리
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 상태 코드 목록을 config 객체로 분리하여 확장 용이하게 |
| **보류 사유** | 현재 고정 상태 코드로 충분 - 복잡도 증가 대비 효과 낮음 |
| **대안/향후 계획** | 향후 사용자 정의 상태 코드 요구 시 고려 |

### 9.4 적용 결과 요약

| 구분 | P1 | P2 | P3 | P4 | P5 | 합계 |
|------|----|----|----|----|----|----|
| 리뷰 이슈 | 0 | 0 | 3 | 4 | 3 | 10 |
| ✅ 적용 | 0 | 0 | 2 | 3 | 1 | 6 |
| 📝 조정 적용 | 0 | 0 | 1 | 0 | 0 | 1 |
| ⏸️ 보류 | 0 | 0 | 0 | 1 | 2 | 3 |

**카테고리별**:
- 🏗️ 아키텍처: 4개 적용 / 0개 보류
- 🛡️ 보안: 0개 적용 / 1개 보류
- ⚡ 성능: 1개 적용 / 1개 보류
- 📝 품질: 2개 적용 / 1개 보류

### 9.5 주요 변경 내역

| # | 섹션 | 변경 요약 |
|---|------|----------|
| 1 | 4.1 WbsValidator | ValidationOptions 인터페이스 추가 (failFast, depth), 순환 참조 검출 알고리즘 추가 |
| 2 | 4.2 IdValidator | validateId에 depth 파라미터 추가, Task ID 유연 매칭 로직 |
| 3 | 4.3 AttributeValidator | VALID_CATEGORIES, VALID_PRIORITIES 공통 상수 참조 |
| 4 | 4.4 StatusValidator | VALID_STATUS_CODES 공통 상수 참조, types/index.ts에 정의 |
| 5 | 4.5 HierarchyValidator | Task/ACT 루트 케이스 처리 로직 추가 |

### 9.6 개선 효과

- **설계 품질**: 파서/시리얼라이저/검증기 간 상수 공유로 정합성 보장
- **리스크 해소**: Task 루트 케이스, 순환 참조 명시적 처리
- **사용성 향상**: failFast 옵션으로 빠른 피드백 가능
- **유지보수성**: 매직 스트링 제거, 공통 타입 정의
- **요구사항 커버리지**: 100% 유지
