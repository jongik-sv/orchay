# 설계 리뷰: wbs.md 시리얼라이저 구현

## 문서 정보

| 항목 | 내용 |
|------|------|
| Task ID | TSK-02-02-02 |
| 리뷰 유형 | LLM 설계 리뷰 |
| 리뷰 일시 | 2025-12-14 |
| 리뷰어 | Claude |
| 리뷰 대상 문서 | 020-detail-design.md, 025-traceability-matrix.md |

---

## 1. 리뷰 요약

### 1.1 전체 평가

| 검증 영역 | 평가 | 비고 |
|----------|------|------|
| 문서 완전성 | PASS | 필수 섹션 모두 포함 |
| 요구사항 추적성 | PASS | FR 4개, BR 5개 100% 커버리지 |
| 아키텍처 설계 | PASS | 컴포넌트 분리 및 데이터 흐름 명확 |
| 보안 고려사항 | PASS | 입력 검증, 출력 크기 제한 |
| 성능 설계 | PASS | 문자열 빌더, 메모이제이션 전략 |
| 테스트 전략 | PASS | 단위 24개, 통합 5개 테스트 계획 |

### 1.2 이슈 통계

| 심각도 | 개수 |
|--------|------|
| Critical | 0 |
| High | 1 |
| Medium | 2 |
| Low | 3 |
| Info | 1 |

---

## 2. 상세 리뷰 결과

### 2.1 문서 구조 검증

#### 긍정 사항
- Mermaid 다이어그램으로 데이터 흐름이 시각화됨
- 알고리즘이 단계별로 명확하게 기술됨
- 비즈니스 규칙이 구현 위치와 함께 매핑됨
- 구현 가이드에 파일 구조와 순서가 명시됨

#### 개선 필요 사항
없음

---

### 2.2 요구사항 추적성 검증

#### 긍정 사항
- FR → 설계 → 테스트 간 완전한 추적성 확보
- 변경 영향 분석 테이블로 유지보수성 고려됨
- PRD 섹션과 기능 요구사항 간 매핑 완료

#### 이슈

| ID | 심각도 | 우선순위 | 이슈 내용 | 권장 조치 |
|----|--------|----------|----------|----------|
| REQ-001 | Medium | P3 | 테스트 명세 문서(026-test-specification.md)가 참조되어 있으나 실제 파일이 존재하지 않음 | 구현 전 테스트 명세 문서 작성 필요 |

---

### 2.3 아키텍처 검증

#### 긍정 사항
- 5개 컴포넌트로 책임 분리 (WbsSerializer, HeaderSerializer, AttributeSerializer, TreeTraverser, MetadataBuilder)
- 순수 함수 설계로 부작용 최소화
- 내부/외부 인터페이스 명확히 구분

#### 이슈

| ID | 심각도 | 우선순위 | 이슈 내용 | 권장 조치 |
|----|--------|----------|----------|----------|
| ARCH-001 | High | P2 | `progress` 속성 출력 시 `{value}%` 형식으로 되어 있으나, 파서(TSK-02-02-01)에서 `%` 처리 로직이 없어 Round-trip 시 데이터 불일치 발생 가능 | 파서와 시리얼라이저 간 progress 형식 통일 필요. 파서에서 `%` 제거 후 숫자로 저장하거나, 시리얼라이저에서 `%` 없이 출력 |
| ARCH-002 | Low | P4 | `calculateMaxDepth` 함수가 시리얼라이저 내부에 있으나, 파서에서도 동일한 로직이 필요할 수 있어 중복 가능성 | 공통 유틸리티로 분리하여 재사용 권장 |

---

### 2.4 보안 검증

#### 긍정 사항
- 재귀 깊이 제한 (10레벨)
- 노드 수 제한 (1000개)
- 마크다운 인젝션 방지를 위한 특수문자 이스케이프 고려
- 출력 크기 제한 (10MB, 50000줄)

#### 이슈

| ID | 심각도 | 우선순위 | 이슈 내용 | 권장 조치 |
|----|--------|----------|----------|----------|
| SEC-001 | Low | P5 | 특수 문자 이스케이프 대상이 `#`, `-`, `>` 로 명시되어 있으나, 실제 이스케이프 로직이 설계에 없음 | title에 `#` 포함 시 처리 로직 명시 필요. 실제로는 wbs.md 특성상 title에 마크다운 특수문자 사용이 드물어 Low 우선순위 |

---

### 2.5 성능 검증

#### 긍정 사항
- 성능 목표 명확: 100개 노드 < 100ms
- 문자열 빌더 사용으로 O(n) 문자열 연결
- 메모이제이션으로 중복 계산 방지

#### 이슈

| ID | 심각도 | 우선순위 | 이슈 내용 | 권장 조치 |
|----|--------|----------|----------|----------|
| PERF-001 | Info | P5 | JavaScript/TypeScript에서 문자열 빌더 패턴이 배열 + join보다 항상 효율적이지 않음 | 구현 시 `array.push()` + `array.join('\n')` 패턴 고려. 현대 엔진에서 충분히 효율적 |

---

### 2.6 테스트 전략 검증

#### 긍정 사항
- Round-trip 테스트(INT-003)로 파서와의 호환성 검증 계획
- 엣지 케이스(빈 트리, 깊은 트리, 순환 참조) 정의
- 예상 커버리지 97%

#### 이슈

| ID | 심각도 | 우선순위 | 이슈 내용 | 권장 조치 |
|----|--------|----------|----------|----------|
| TEST-001 | Medium | P3 | Round-trip 테스트가 파서 구현(TSK-02-02-01) 완료 후에만 가능하여 의존성 있음 | 구현 순서를 파서 → 시리얼라이저로 유지하거나, 시리얼라이저 단독 테스트 후 Round-trip 테스트 별도 수행 |
| TEST-002 | Low | P4 | 순환 참조 테스트(엣지 케이스)에서 SerializationError 발생이 예상되나, 실제 순환 참조 검출 로직이 설계에 없음 | 재귀 깊이 제한으로 간접 검출되나, 명시적 검출 로직 추가 권장 |

---

## 3. 설계 품질 메트릭

| 메트릭 | 값 | 평가 |
|--------|-----|------|
| 요구사항 커버리지 | 100% | 우수 |
| 테스트 케이스 수 | 29개 | 충분 |
| 컴포넌트 수 | 5개 | 적정 |
| 문서 완성도 | 15개 섹션 | 완전 |

---

## 4. 권장 사항 요약

### 4.1 구현 전 조치 필요 (P2-P3)
1. **[High]** `progress` 속성의 `%` 처리 방식을 파서와 통일 (ARCH-001)
2. 테스트 명세 문서(026-test-specification.md) 작성
3. Round-trip 테스트 의존성 고려한 구현 순서 확정

### 4.2 구현 중 고려 (P4-P5)
1. `calculateMaxDepth` 공통 유틸리티 분리 검토
2. 순환 참조 명시적 검출 로직 추가
3. 특수 문자 이스케이프 로직 구현

---

## 5. 파서-시리얼라이저 호환성 체크리스트

| 항목 | 파서 설계 | 시리얼라이저 설계 | 호환성 |
|------|----------|------------------|--------|
| 헤더 형식 | `## WP-01: Title` | `## WP-01: Title` | OK |
| 상태 형식 | `[xx]` 추출 | `{status}` 그대로 출력 | OK |
| 스케줄 형식 | `start ~ end` 파싱 | `start ~ end` 출력 | OK |
| requirements | 하위 목록 파싱 | 2칸 들여쓰기 출력 | 확인 필요 |
| progress | 숫자 저장 | `{value}%` 출력 | **불일치** |
| tags | 배열 파싱 | 쉼표 구분 출력 | OK |

---

## 6. 리뷰 결론

**결과: CONDITIONAL PASS**

설계 문서의 전반적인 품질은 양호하나, `progress` 속성의 `%` 처리 방식이 파서와 불일치하여 Round-trip 시 문제가 발생할 수 있습니다. 이 High 수준 이슈를 구현 전에 해결하거나, 구현 단계에서 파서/시리얼라이저 양쪽을 일관되게 수정해야 합니다.

**권장 조치**: 파서 설계에서 progress가 숫자로 저장된다고 가정할 때, 시리얼라이저에서 `- progress: 50` (% 없이) 형식으로 출력하도록 수정 권장.

---

## 7. 변경 이력

| 버전 | 날짜 | 변경 내용 | 리뷰어 |
|------|------|----------|--------|
| 1.0 | 2025-12-14 | 최초 리뷰 | Claude |

---

## 8. 개선사항 적용 결과

**적용일**: 2025-12-14
**적용자**: Claude Opus 4.5
**수정 문서**: `020-detail-design.md`

### 8.1 적용 방침
- ✅ 시스템&Task 적합 → 적용
- 📝 조정 필요 → 수정 적용
- ⏸️ 부적합 → 보류

### 8.2 적용 완료 이슈

#### [ARCH-001] progress 속성 % 처리 파서와 통일 (P2/High)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 파서에서 progress가 숫자로 저장될 때, 시리얼라이저에서 `- progress: 50` (% 없이) 형식으로 출력 권장 |
| **적용 방식** | ✅ 그대로 |
| **반영 내용** | 속성 포맷팅 알고리즘에서 progress 출력 시 `{value}%` → `{value}` (숫자만)로 변경 |
| **수정 섹션** | 5.2 속성 포맷팅 알고리즘 |
| **적용 사유** | Round-trip 데이터 무결성 보장 필수 - 파서와 형식 통일 |

#### [TEST-002] 순환 참조 명시적 검출 로직 추가 (P4/Low)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 재귀 깊이 제한으로 간접 검출되나, 명시적 검출 로직 추가 권장 |
| **적용 방식** | ✅ 그대로 |
| **반영 내용** | 트리 순회 알고리즘에 visited Set 기반 순환 참조 검출 알고리즘 추가, 에러 메시지에 nodeId 포함 |
| **수정 섹션** | 5.3 트리 순회 알고리즘, 7.1 예외 시나리오 |
| **적용 사유** | 디버깅 용이성 향상 - 순환 참조 발생 시 정확한 노드 식별 가능 |

#### [Gemini P4/Low] 메타데이터 updated 필드 갱신 제어 옵션 (P4/Low)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 내용 변경 감지된 경우에만 updated 날짜 갱신하거나 옵션으로 제어 |
| **적용 방식** | 📝 조정 (옵션 방식으로 단순화) |
| **반영 내용** | SerializerOptions 인터페이스 추가, `updateDate: boolean` 옵션으로 updated 필드 갱신 제어 가능 |
| **수정 섹션** | 5.4 메타데이터 생성 알고리즘 |
| **적용 사유** | Git Diff 노이즈 방지 - 내용 변경 없이 저장 시 불필요한 변경 기록 방지 |

### 8.3 보류 이슈

#### [REQ-001] 테스트 명세 문서 작성 (P3/Medium)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 구현 전 테스트 명세 문서 작성 필요 |
| **보류 사유** | 별도 Task - 테스트 명세는 설계 완료 후 작성 |
| **대안/향후 계획** | 추적성 매트릭스에 테스트 ID 정의됨, 구현 전 작성 예정 |

#### [TEST-001] Round-trip 테스트 의존성 (P3/Medium)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 구현 순서를 파서 → 시리얼라이저로 유지 |
| **보류 사유** | 구현 순서로 해결 - wbs.md에 의존성 명시됨 (depends: TSK-02-02-01) |
| **대안/향후 계획** | 파서 구현 완료 후 Round-trip 테스트 수행 |

#### [ARCH-002] calculateMaxDepth 공통 유틸리티 분리 (P4/Low)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 공통 유틸리티로 분리하여 재사용 권장 |
| **보류 사유** | 현재는 시리얼라이저에서만 사용 - 추후 필요 시 리팩토링 |
| **대안/향후 계획** | 파서에서 동일 로직 필요 시 공통 utils로 이동 |

#### [SEC-001] 특수 문자 이스케이프 로직 (P5/Low)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | title에 `#` 포함 시 처리 로직 명시 |
| **보류 사유** | wbs.md 특성상 title에 마크다운 특수문자 사용이 드물어 현재 불필요 |
| **대안/향후 계획** | 실제 이슈 발생 시 구현 |

#### [PERF-001] 문자열 빌더 vs array.join (P5/Info)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 구현 시 `array.push()` + `array.join('\n')` 패턴 고려 |
| **보류 사유** | 구현 단계에서 결정 - 설계 문서 범위 외 |
| **대안/향후 계획** | 구현 시 현대 엔진 특성 고려하여 선택 |

#### [Gemini P5/Info] 속성 정렬 순서 커스터마이징
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | 향후 사용자 선호도에 따라 속성 출력 순서 설정 가능하도록 확장성 고려 |
| **보류 사유** | 현재 고정 순서로 충분 - 복잡도 증가 대비 효과 낮음 |
| **대안/향후 계획** | 향후 요구사항 발생 시 고려 |

### 8.4 적용 결과 요약

| 구분 | P1 | P2 | P3 | P4 | P5 | 합계 |
|------|----|----|----|----|----|----|
| 리뷰 이슈 | 0 | 1 | 2 | 3 | 4 | 10 |
| ✅ 적용 | 0 | 1 | 0 | 1 | 0 | 2 |
| 📝 조정 적용 | 0 | 0 | 0 | 1 | 0 | 1 |
| ⏸️ 보류 | 0 | 0 | 2 | 1 | 4 | 7 |

**카테고리별**:
- 🏗️ 아키텍처: 2개 적용 / 1개 보류
- 🛡️ 보안: 0개 적용 / 1개 보류
- ⚡ 성능: 0개 적용 / 1개 보류
- 📝 품질: 1개 적용 / 4개 보류

### 8.5 주요 변경 내역

| # | 섹션 | 변경 요약 |
|---|------|----------|
| 1 | 5.2 속성 포맷팅 알고리즘 | progress 출력 시 `%` 제거 - 파서와 Round-trip 호환 |
| 2 | 5.3 트리 순회 알고리즘 | visited Set 기반 순환 참조 명시적 검출 알고리즘 추가 |
| 3 | 5.4 메타데이터 생성 알고리즘 | SerializerOptions 추가, `updateDate` 옵션으로 날짜 갱신 제어 |
| 4 | 7.1 예외 시나리오 | 순환 참조 에러 메시지에 nodeId 포함 |

### 8.6 개선 효과

- **설계 품질**: Round-trip 데이터 무결성 보장 (progress 형식 통일)
- **리스크 해소**: 순환 참조 발생 시 정확한 노드 식별 가능
- **사용성 향상**: Git Diff 노이즈 방지 옵션 제공
- **요구사항 커버리지**: 100% 유지
