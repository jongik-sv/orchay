# TSK-02-01 - 설계 리뷰 결과

## 리뷰 정보

| 항목 | 내용 |
|------|------|
| Task ID | TSK-02-01 |
| 리뷰어 | claude-1 |
| 리뷰 일자 | 2026-01-02 |
| 리뷰 대상 | Socket.io 서버 설정 및 Custom Server 구성 |

---

## 1. 검증 대상 문서

| 문서 | 상태 | 비고 |
|------|------|------|
| 010-design.md | ✅ 존재 | 통합 설계 문서 |
| 025-traceability-matrix.md | ❌ 미존재 | 필수 문서 누락 |
| 026-test-specification.md | ❌ 미존재 | 필수 문서 누락 |

---

## 2. 검증 결과 요약

| 검증 영역 | 평가 | 비고 |
|----------|------|------|
| 문서 완전성 | ⚠️ WARN | 추적성 매트릭스, 테스트 명세 누락 |
| 요구사항 추적성 | ⚠️ WARN | 별도 매트릭스 문서 필요 |
| 아키텍처 | ⚠️ WARN | 2건 개선 권장 |
| 보안 | ⚠️ WARN | 1건 개선 권장 |
| 성능 | ✅ PASS | MVP 수준 적합 |
| 테스트 가능성 | ⚠️ WARN | 상세 테스트 명세 필요 |

---

## 3. 상세 이슈 목록

### 3.1 Critical (P1) - 0건

없음

### 3.2 High (P2) - 2건

#### RV-001: 추적성 매트릭스 누락

| 항목 | 내용 |
|------|------|
| 심각도 | High |
| 우선순위 | P2 |
| 영역 | 문서 완전성 |
| 위치 | tasks/TSK-02-01/ |
| 문제 | `025-traceability-matrix.md` 파일이 존재하지 않음 |
| 영향 | PRD → 설계 → 테스트 간 요구사항 추적 불가 |
| 권장 조치 | PRD의 WebSocket 이벤트(K-001, K-002, C-031 등)와 설계 요소 간 매핑 문서 작성 필요 |

#### RV-002: 테스트 명세 누락

| 항목 | 내용 |
|------|------|
| 심각도 | High |
| 우선순위 | P2 |
| 영역 | 테스트 가능성 |
| 위치 | tasks/TSK-02-01/ |
| 문제 | `026-test-specification.md` 파일이 존재하지 않음 |
| 영향 | 구현 후 검증 기준 불명확 |
| 권장 조치 | 상세 테스트 케이스(연결, 룸 조인, 연결 해제 시나리오) 문서 작성 필요 |

### 3.3 Medium (P3) - 2건

#### RV-003: 전역 io 인스턴스 타입 안전성 부족

| 항목 | 내용 |
|------|------|
| 심각도 | Medium |
| 우선순위 | P3 |
| 영역 | 아키텍처 |
| 위치 | 010-design.md - 섹션 6.1 (Line 248-300) |
| 문제 | `(global as any).io = io` 사용으로 TypeScript 타입 안전성 미확보 |
| 코드 |
```typescript
// 현재 코드
(global as any).io = io;
```
| 권장 조치 | global 타입 확장 선언 추가 필요 |
| 수정 예시 |
```typescript
// 타입 선언 (예: types/global.d.ts)
import { Server } from 'socket.io';

declare global {
  var io: Server | undefined;
}

// 사용 시
global.io = io;
```

#### RV-004: 룸 이름 유효성 검증 부재

| 항목 | 내용 |
|------|------|
| 심각도 | Medium |
| 우선순위 | P3 |
| 영역 | 보안 |
| 위치 | 010-design.md - 섹션 6.1 (Line 278-281) |
| 문제 | `join:table` 이벤트 핸들러에서 tableId 유효성 검증 없음 |
| 코드 |
```typescript
socket.on('join:table', (tableId: number) => {
  const room = `table:${tableId}`;
  socket.join(room);
});
```
| 영향 | 악의적인 클라이언트가 임의의 tableId로 룸 조인 가능 |
| 권장 조치 | tableId가 유효한 숫자인지, 허용 범위 내인지 검증 추가 |
| 수정 예시 |
```typescript
socket.on('join:table', (tableId: unknown) => {
  if (typeof tableId !== 'number' || tableId < 1 || tableId > 100) {
    console.warn(`[Socket.io] 잘못된 tableId: ${tableId}`);
    return;
  }
  const room = `table:${tableId}`;
  socket.join(room);
});
```

### 3.4 Low (P4) - 1건

#### RV-005: 에러 핸들링 부재

| 항목 | 내용 |
|------|------|
| 심각도 | Low |
| 우선순위 | P4 |
| 영역 | 아키텍처 |
| 위치 | 010-design.md - 섹션 6.1 |
| 문제 | Socket.io 연결 오류, 서버 시작 오류 등에 대한 에러 핸들링 코드 없음 |
| 권장 조치 | error 이벤트 핸들러 및 try-catch 추가 고려 |
| 수정 예시 |
```typescript
io.on('connection', (socket) => {
  socket.on('error', (err) => {
    console.error(`[Socket.io] 소켓 에러: ${socket.id}`, err);
  });
  // ...
});
```

### 3.5 Info (P5) - 1건

#### RV-006: 연결 로그 구조화 고려

| 항목 | 내용 |
|------|------|
| 심각도 | Info |
| 우선순위 | P5 |
| 영역 | 품질 |
| 위치 | 010-design.md - 섹션 6.1 |
| 문제 | console.log 사용으로 프로덕션 로그 관리 어려움 |
| 권장 조치 | MVP 이후 구조화된 로깅(pino 등) 도입 고려 |

---

## 4. 이슈 분포 요약

| 우선순위 | 건수 | 설명 |
|----------|------|------|
| P1 (Critical) | 0 | - |
| P2 (High) | 2 | 필수 문서 누락 |
| P3 (Medium) | 2 | 타입 안전성, 입력 검증 |
| P4 (Low) | 1 | 에러 핸들링 |
| P5 (Info) | 1 | 로깅 개선 |
| **합계** | **6** | |

---

## 5. 설계 문서 품질 분석

### 5.1 긍정적 측면

1. **명확한 범위 정의**: 포함/제외 범위가 명확히 구분됨 (TSK-02-02로 이관되는 항목 명시)
2. **유즈케이스 다이어그램**: Mermaid로 시각화되어 이해하기 쉬움
3. **사용자 시나리오**: 단계별 진행 및 성공 조건이 잘 정의됨
4. **코드 예시 포함**: 구현 가이드로 활용 가능한 상세 코드 제공
5. **의존성 명시**: TSK-01-03 선행 필요 사항 명확

### 5.2 개선 필요 사항

1. **필수 산출물 누락**: 025, 026 문서 미작성
2. **타입 안전성**: global 타입 확장 미정의
3. **입력 검증**: tableId 유효성 검증 로직 필요

---

## 6. PRD/TRD 정합성 검증

### 6.1 PRD 요구사항 커버리지

| PRD 요구사항 | 설계 반영 | 비고 |
|-------------|----------|------|
| WebSocket 이벤트 (섹션 5) | ✅ 반영 | join:table, join:kitchen 정의됨 |
| order:new 이벤트 | ⚠️ TSK-02-02 | 현재 Task 범위 외 |
| order:status 이벤트 | ⚠️ TSK-02-02 | 현재 Task 범위 외 |

### 6.2 TRD 기술 요구사항 정합성

| TRD 요구사항 | 설계 반영 | 비고 |
|-------------|----------|------|
| Socket.io 4.x | ✅ 반영 | 명시됨 |
| Custom Server | ✅ 반영 | server.ts 설계 포함 |
| tsx 런타임 | ✅ 반영 | package.json 스크립트에 포함 |

---

## 7. 권장 사항

### 7.1 구현 전 필수 조치 (P2)

1. **025-traceability-matrix.md 작성**
   - PRD K-001, K-002, C-031 ↔ UC-01, UC-02, UC-03 매핑
   - 테스트 케이스 연결

2. **026-test-specification.md 작성**
   - 연결 성공/실패 케이스
   - 룸 조인 케이스
   - 연결 해제 케이스

### 7.2 구현 중 권장 조치 (P3)

3. **global 타입 선언 추가**
   - `types/global.d.ts` 파일 생성

4. **tableId 유효성 검증 추가**
   - 타입 검증 + 범위 검증

### 7.3 구현 후 권장 조치 (P4-P5)

5. 에러 이벤트 핸들러 추가
6. 로깅 구조화 (향후)

---

## 8. 결론

| 항목 | 결과 |
|------|------|
| 리뷰 판정 | ⚠️ **조건부 승인** |
| 필수 조치 | P2 이슈 2건 해결 후 구현 진행 권장 |
| 다음 단계 | `/wf:apply` 또는 P2 이슈 해결 후 `/wf:build` |

설계 문서 자체의 품질은 양호하나, 필수 산출물(추적성 매트릭스, 테스트 명세)이 누락되어 있습니다.
구현 전에 해당 문서를 보완하거나, `/wf:apply`를 통해 리뷰 지적 사항을 반영한 후 진행하는 것을 권장합니다.

---

---

## 9. 적용 결과

> 적용일: 2026-01-02

### 9.1 적용 판단 요약

| 이슈 ID | 우선순위 | 판단 | 사유 |
|---------|---------|------|------|
| RV-001 | P2 | ✅ 적용 | 필수 문서 - `025-traceability-matrix.md` 작성 |
| RV-002 | P2 | ✅ 적용 | 필수 문서 - `026-test-specification.md` 작성 |
| RV-003 | P3 | ✅ 적용 | `types/global.d.ts` 타입 선언 추가 |
| RV-004 | P3 | ✅ 적용 | `isValidTableId()` 검증 함수 추가 |
| RV-005 | P4 | ✅ 적용 | `socket.on('error')` 핸들러 추가 |
| RV-006 | P5 | ⏸️ 보류 | MVP 범위 초과 - 향후 고려 |

### 9.2 수정된 문서

| 문서 | 변경 내용 |
|------|----------|
| `010-design.md` | 타입 선언, 입력 검증, 에러 핸들링 코드 추가 |
| `025-traceability-matrix.md` | 신규 작성 |
| `026-test-specification.md` | 신규 작성 |

### 9.3 처리 통계

| 구분 | 건수 |
|------|------|
| ✅ 적용 | 5건 |
| ⏸️ 보류 | 1건 |
| 합계 | 6건 |

---

## 변경 이력

| 버전 | 일자 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-02 | claude-1 | 최초 작성 |
| 1.1 | 2026-01-02 | Claude | 적용 결과 섹션 추가 |
