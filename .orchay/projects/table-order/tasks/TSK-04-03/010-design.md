# TSK-04-03 - WP-04 통합 확인: 주방 화면 검증 설계 문서

## 문서 정보

| 항목 | 내용 |
|------|------|
| Task ID | TSK-04-03 |
| 문서 버전 | 1.0 |
| 작성일 | 2026-01-02 |
| 상태 | 작성중 |
| 카테고리 | development |
| 도메인 | test |

---

## 1. 개요

### 1.1 배경 및 문제 정의

**현재 상황:**
- TSK-04-01: 주방 주문 현황 페이지 구현 완료
- TSK-04-02: 주문 상태 관리 기능 구현 완료
- 개별 기능은 구현되었으나 전체 플로우에 대한 통합 검증이 필요함

**해결하려는 문제:**
- WP-04 (주방 화면) 전체 기능이 PRD 요구사항을 만족하는지 검증
- 개별 컴포넌트 간의 통합이 정상적으로 동작하는지 확인
- 실시간 통신과 UI 업데이트의 일관성 검증

### 1.2 목적 및 기대 효과

**목적:**
- WP-04 주방 화면(KDS)의 전체 기능 통합 검증
- PRD K-001 ~ K-012 요구사항 충족 확인
- 실시간 주문 수신 및 상태 관리 전체 플로우 검증

**기대 효과:**
- 주방 화면 기능의 품질 보증
- 잠재적 통합 이슈 조기 발견
- MVP 출시 전 핵심 기능 안정성 확보

### 1.3 범위

**검증 대상:**
- /kitchen 페이지 접근 및 렌더링
- 대기/조리중 주문 목록 표시
- WebSocket 실시간 주문 수신
- 새 주문 알림음 재생
- 조리시작 버튼 (pending → cooking)
- 조리완료 버튼 (cooking → completed)
- 완료 주문 숨김/별도 표시
- 주문 카드 그리드 레이아웃

**제외:**
- 고객 화면 연동 (TSK-03-04에서 검증)
- E2E 전체 플로우 (TSK-05-01에서 검증)

### 1.4 참조 문서

| 문서 | 경로 | 관련 섹션 |
|------|------|----------|
| PRD | `.orchay/projects/table-order/prd.md` | 섹션 3.2 주방 화면 (K-001 ~ K-012) |
| TRD | `.orchay/projects/table-order/trd.md` | 섹션 5 실시간 통신 |
| TSK-04-01 설계 | `../TSK-04-01/010-design.md` | 주방 주문 현황 페이지 |
| TSK-04-02 설계 | `../TSK-04-02/010-design.md` | 주문 상태 관리 기능 |

---

## 2. 검증 대상 요구사항

### 2.1 PRD 요구사항 매핑

| 요구사항 ID | 기능 | 설명 | 검증 항목 |
|------------|------|------|----------|
| K-001 | 실시간 주문 표시 | 새 주문 즉시 화면에 추가 | TC-001 |
| K-002 | 알림음 | 새 주문 시 알림음 재생 | TC-002 |
| K-003 | 주문 정보 | 테이블 번호, 메뉴명, 수량, 주문 시간 | TC-003 |
| K-010 | 조리 시작 | 버튼 클릭 시 "조리중" 상태로 변경 | TC-004 |
| K-011 | 조리 완료 | 버튼 클릭 시 "완료" 상태로 변경 | TC-005 |
| K-012 | 완료 주문 숨김 | 완료된 주문 목록에서 제거 또는 별도 표시 | TC-006 |

---

## 3. 사용자 시나리오

### 3.1 시나리오 1: 주방 화면 접속 및 주문 확인

**상황 설명:**
주방 직원이 영업 시작 시 주방 모니터에서 /kitchen 페이지에 접속하여 대기 중인 주문을 확인한다.

**단계별 진행:**

| 단계 | 사용자 행동 | 시스템 반응 | 예상 결과 |
|------|-----------|------------|----------|
| 1 | /kitchen URL 접속 | 페이지 로딩 | 로딩 스피너 표시 후 페이지 렌더링 |
| 2 | 화면 확인 | 주문 목록 API 호출 | 대기/조리중 주문 카드 그리드 표시 |
| 3 | 주문 카드 확인 | - | 테이블 번호, 메뉴, 수량, 경과 시간 표시 |

**성공 조건:**
- 3초 이내 주문 목록 로딩 완료
- 그리드 레이아웃 정상 표시 (데스크톱: 3-4열)
- 주문 정보 정확히 표시

### 3.2 시나리오 2: 새 주문 실시간 수신

**상황 설명:**
고객이 테이블에서 새 주문을 생성하면 주방 화면에 실시간으로 추가된다.

**단계별 진행:**

| 단계 | 사용자 행동 | 시스템 반응 | 예상 결과 |
|------|-----------|------------|----------|
| 1 | (대기 중) | 고객이 주문 생성 | - |
| 2 | - | WebSocket order:new 이벤트 수신 | - |
| 3 | - | 알림음 재생 | 알림음 정상 재생 |
| 4 | 화면 확인 | 새 주문 카드 추가 | 그리드 맨 앞에 새 카드 표시 |

**성공 조건:**
- 주문 생성 후 1초 이내 화면에 표시
- 알림음 재생 (브라우저 정책 허용 시)
- 새 주문 카드에 정확한 정보 표시

### 3.3 시나리오 3: 주문 처리 전체 플로우

**상황 설명:**
주방 직원이 주문을 접수하고 조리 시작/완료 처리하는 전체 플로우

**단계별 진행:**

| 단계 | 사용자 행동 | 시스템 반응 | 예상 결과 |
|------|-----------|------------|----------|
| 1 | pending 주문 카드 확인 | - | [조리시작] 버튼 표시 |
| 2 | [조리시작] 클릭 | API 호출, 상태 변경 | 카드 스타일 변경 (cooking), "조리중" 배지 |
| 3 | 조리 완료 후 [조리완료] 클릭 | API 호출, 상태 변경 | 카드가 그리드에서 제거/숨김 |
| 4 | - | WebSocket으로 고객에게 알림 | 고객 화면에 상태 반영 |

**성공 조건:**
- 상태 변경 즉시 UI 반영
- 완료 주문 자동 숨김
- 고객 화면에 실시간 상태 업데이트

### 3.4 시나리오 4: 에러 상황 대응

**상황 설명:**
네트워크 오류 등으로 API 호출이 실패하는 상황

**단계별 진행:**

| 단계 | 사용자 행동 | 시스템 반응 | 복구 방법 |
|------|-----------|------------|----------|
| 1 | [조리시작] 클릭 | 로딩 표시 | - |
| 2 | - | API 실패 | 에러 메시지 토스트 표시 |
| 3 | - | 버튼 상태 복원 | 재시도 가능 |

**성공 조건:**
- 명확한 에러 메시지 표시
- 버튼 상태 정상 복원
- 재시도 가능한 상태 유지

---

## 4. 화면 설계

### 4.1 주방 화면 전체 레이아웃

**와이어프레임:**
```
┌─────────────────────────────────────────────────────────────────────┐
│  주방 주문 현황                                              [연결됨] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐     │
│  │  테이블 3        │  │  테이블 5 [조리중]│  │  테이블 1        │     │
│  │ ─────────────── │  │ ─────────────── │  │ ─────────────── │     │
│  │ 김치찌개    x1  │  │ 된장찌개    x2  │  │ 비빔밥      x1  │     │
│  │ 공기밥      x2  │  │ 공기밥      x2  │  │                 │     │
│  │ ─────────────── │  │ ─────────────── │  │ ─────────────── │     │
│  │   5분 전        │  │   3분 전        │  │   1분 전        │     │
│  │                 │  │                 │  │                 │     │
│  │ [  조리시작  ]  │  │ [  조리완료  ]  │  │ [  조리시작  ]  │     │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 4.2 상태별 카드 스타일

| 상태 | 배경색 | 버튼 | 배지 |
|------|--------|------|------|
| pending | 흰색 반투명 (bg-white/25) | [조리시작] Primary | 없음 |
| cooking | 앰버 반투명 (bg-amber-500/15) | [조리완료] Success | "조리중" |
| completed | (숨김) | - | - |

### 4.3 반응형 그리드

| 화면 크기 | 열 수 | 비고 |
|----------|------|------|
| 1280px+ | 4열 | 대형 모니터 |
| 1024-1279px | 3열 | 일반 데스크톱 |
| 768-1023px | 2열 | 태블릿 |
| 767px- | 1열 | 모바일 (비권장) |

---

## 5. 인터랙션 설계

### 5.1 사용자 액션과 피드백

| 사용자 액션 | 즉각 피드백 | 결과 피드백 | 에러 피드백 |
|------------|-----------|------------|------------|
| 페이지 접속 | 로딩 스피너 | 주문 목록 표시 | 에러 메시지 + 재시도 |
| 새 주문 수신 | 알림음 | 카드 추가 | - |
| 조리시작 클릭 | 버튼 로딩 | 카드 스타일 변경 | 토스트 에러 |
| 조리완료 클릭 | 버튼 로딩 | 카드 페이드 아웃 | 토스트 에러 |

### 5.2 상태별 화면 변화

| 상태 | 화면 표시 | 사용자 안내 |
|------|----------|------------|
| 초기 로딩 | 로딩 스피너 | "주문을 불러오는 중..." |
| 주문 없음 | 빈 상태 이미지 | "현재 대기 중인 주문이 없습니다" |
| WebSocket 연결됨 | 헤더 "연결됨" 표시 (녹색) | - |
| WebSocket 끊김 | 헤더 "연결 끊김" 표시 (빨간색) | 자동 재연결 시도 |
| 새 주문 | 카드 추가 + 알림음 | - |

---

## 6. 데이터 요구사항

### 6.1 필요한 데이터

| 데이터 | 설명 | 출처 | 용도 |
|--------|------|------|------|
| 주문 목록 | pending/cooking 상태 주문 | GET /api/kitchen/orders | 초기 로딩 |
| 새 주문 | 실시간 새 주문 정보 | WebSocket order:new | 목록 추가 |
| 상태 변경 | 주문 상태 업데이트 | PATCH /api/orders/{id}/status | 상태 전이 |

### 6.2 API 엔드포인트

| Method | Endpoint | 설명 | 요청 | 응답 |
|--------|----------|------|------|------|
| GET | /api/kitchen/orders | 대기/조리중 주문 조회 | - | `{ orders: Order[] }` |
| PATCH | /api/orders/{id}/status | 주문 상태 변경 | `{ status: string }` | `{ success: true }` |

### 6.3 WebSocket 이벤트

| 이벤트 | 방향 | 데이터 | 용도 |
|--------|------|--------|------|
| join:kitchen | Client → Server | - | kitchen 룸 조인 |
| order:new | Server → Client | Order 객체 | 새 주문 수신 |
| order:status | Server → Client | `{ orderId, status }` | 상태 변경 알림 |

---

## 7. 비즈니스 규칙

### 7.1 핵심 규칙

| 규칙 ID | 규칙 설명 | 검증 방법 |
|---------|----------|----------|
| BR-01 | pending/cooking 상태 주문만 메인 그리드에 표시 | 목록 필터링 확인 |
| BR-02 | 새 주문 시 알림음 재생 | 오디오 재생 확인 |
| BR-03 | pending → cooking만 허용 | 잘못된 전이 시 에러 확인 |
| BR-04 | cooking → completed만 허용 | 잘못된 전이 시 에러 확인 |
| BR-05 | completed 주문 자동 숨김 | 상태 변경 후 목록 확인 |

---

## 8. 에러 처리

### 8.1 예상 에러 상황

| 상황 | 원인 | 사용자 메시지 | 복구 방법 |
|------|------|--------------|----------|
| 초기 로딩 실패 | 서버/네트워크 오류 | "주문을 불러올 수 없습니다" | 재시도 버튼 |
| WebSocket 연결 실패 | 서버/네트워크 오류 | "연결 끊김" (헤더) | 자동 재연결 |
| 상태 변경 실패 | API 오류 | "상태 변경에 실패했습니다" | 재시도 가능 |
| 알림음 재생 실패 | 브라우저 정책 | (무시) | 사용자 인터랙션 후 활성화 |

---

## 9. 연관 문서

| 문서 | 경로 | 용도 |
|------|------|------|
| 요구사항 추적 매트릭스 | `025-traceability-matrix.md` | PRD → 설계 → 테스트 양방향 추적 |
| 테스트 명세서 | `026-test-specification.md` | 단위/E2E/매뉴얼 테스트 상세 정의 |

---

## 10. 구현 범위

### 10.1 검증 대상 파일

| 파일 | 검증 내용 |
|------|----------|
| `app/kitchen/page.tsx` | 페이지 렌더링, 상태 관리 |
| `components/OrderCard.tsx` | 주문 카드 표시, 버튼 동작 |
| `lib/socket.ts` | WebSocket 연결 및 이벤트 |

### 10.2 의존성

| 의존 항목 | 이유 | 상태 |
|----------|------|------|
| TSK-04-01 | 주방 주문 현황 페이지 | 구현 완료 필요 |
| TSK-04-02 | 주문 상태 관리 기능 | 구현 완료 필요 |
| TSK-01-03 | 주문 API | 구현 완료 |
| TSK-02-02 | WebSocket 이벤트 | 구현 완료 필요 |

---

## 11. 체크리스트

### 11.1 설계 완료 확인

- [x] 문제 정의 및 목적 명확화
- [x] 검증 대상 요구사항 매핑 완료
- [x] 사용자 시나리오 작성 완료
- [x] 화면 설계 완료 (와이어프레임)
- [x] 인터랙션 설계 완료
- [x] 데이터 요구사항 정의 완료
- [x] 비즈니스 규칙 정의 완료
- [x] 에러 처리 정의 완료

### 11.2 연관 문서 작성

- [ ] 요구사항 추적 매트릭스 작성 (→ `025-traceability-matrix.md`)
- [ ] 테스트 명세서 작성 (→ `026-test-specification.md`)

### 11.3 검증 준비

- [x] 검증 우선순위 결정
- [x] 의존성 확인 완료
- [x] 테스트 시나리오 정의 완료

---

## 변경 이력

| 버전 | 일자 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-02 | Claude | 최초 작성 |
