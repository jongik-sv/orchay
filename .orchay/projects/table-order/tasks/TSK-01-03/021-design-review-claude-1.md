# TSK-01-03 설계 리뷰 결과

## 문서 정보

| 항목 | 내용 |
|------|------|
| Task ID | TSK-01-03 |
| 리뷰어 | claude-1 |
| 리뷰 일시 | 2026-01-02 |
| 상태 | 완료 |

---

## 검증 대상 문서

| 문서 | 상태 | 비고 |
|------|------|------|
| 010-design.md | ✅ 존재 | 주문 생성/조회 API 설계 |
| 025-traceability-matrix.md | ⚠️ 없음 | 작성 필요 |
| 026-test-specification.md | ⚠️ 없음 | 작성 필요 |

---

## 검증 결과 요약

| 검증 영역 | 평가 | 비고 |
|----------|------|------|
| 문서 완전성 | **WARN** | 추적성 매트릭스, 테스트 명세 미작성 |
| 요구사항 추적성 | **WARN** | FR/BR 매핑 문서 누락 |
| 아키텍처 | **PASS** | CRUD API 구조 적절 |
| 보안 | **WARN** | 2건 개선 필요 |
| 테스트 가능성 | **WARN** | 테스트 시나리오 미정의 |
| 데이터 무결성 | **PASS** | 트랜잭션 처리 명시 |

---

## 상세 리뷰 결과

### P1 - Critical (구현 전 필수 수정)

| # | 영역 | 이슈 | 개선안 |
|---|------|------|--------|
| 1 | **보안** | 주방 API (`/api/kitchen/orders`, `/api/orders/{id}/status`)에 인증/인가 없음 | 주방 API는 별도 인증 또는 Basic Auth 등 최소 보호 필요. MVP라도 URL 직접 접근 방지 필요 |

### P2 - High (구현 초기 수정)

| # | 영역 | 이슈 | 개선안 |
|---|------|------|--------|
| 2 | **입력 검증** | `quantity` 최대값 제한 없음 | 합리적 최대값 설정 (예: 99) |
| 3 | **에러 처리** | 동시성 처리 미고려 - 동일 주문 동시 상태 변경 시 race condition | 낙관적 잠금 또는 버전 필드 고려 |
| 4 | **문서 완전성** | 025-traceability-matrix.md 미작성 | PRD 요구사항과 API 매핑 문서 작성 |
| 5 | **문서 완전성** | 026-test-specification.md 미작성 | 테스트 케이스 정의 문서 작성 |

### P3 - Medium (구현 중 수정)

| # | 영역 | 이슈 | 개선안 |
|---|------|------|--------|
| 6 | **API 설계** | `GET /api/orders?table={id}` - 완료된 주문도 모두 반환하면 데이터 증가 시 성능 저하 | 상태 필터 또는 당일 주문만 조회 옵션 추가 |
| 7 | **응답 형식** | `PATCH /api/orders/{id}/status` 응답이 `{ success: true }`만 반환 | 변경된 주문 상태 전체를 반환하면 추가 조회 불필요 |
| 8 | **타입 안전성** | `status` 필드가 문자열 리터럴로만 정의 - DB에서 잘못된 값 저장 가능 | CHECK 제약 조건 또는 Enum 테이블 고려 |

### P4 - Low (구현 후 검토)

| # | 영역 | 이슈 | 개선안 |
|---|------|------|--------|
| 9 | **확장성** | 주문 항목별 상태 변경 API 없음 (전체 주문 단위만) | 현재 MVP 범위에서는 OK, 향후 확장 고려 |
| 10 | **로깅** | 상태 변경 이력 추적 불가 | 향후 `order_status_history` 테이블 고려 |

### P5 - Info (참고)

| # | 영역 | 이슈 | 비고 |
|---|------|------|------|
| 11 | **모범 사례** | 주문 생성 시 총액 계산이 서버에서 수행되지 않음 | MVP에서는 클라이언트 표시용으로 충분, 결제 도입 시 서버 계산 필수 |

---

## 이슈 분포

```
P1(1) P2(4) P3(3) P4(2) P5(1) = 총 11건
```

---

## 긍정적 평가

1. **유즈케이스 상세화**: UC-01~04까지 기본/예외 흐름 잘 정의됨
2. **비즈니스 규칙 명시**: BR-01 상태 전이 규칙이 명확함
3. **에러 코드 체계**: HTTP 상태 코드와 에러 코드가 일관됨
4. **데이터 관계 다이어그램**: ERD가 명확함
5. **트랜잭션 처리**: BR-02에서 단일 트랜잭션 명시

---

## 권장 조치

### 즉시 수정 (P1)

주방 API에 최소 인증 추가:

```typescript
// 옵션 1: 환경변수 기반 토큰
// GET /api/kitchen/orders?token=KITCHEN_SECRET
const token = searchParams.get('token');
if (token !== process.env.KITCHEN_TOKEN) {
  return Response.json({ error: 'Unauthorized' }, { status: 401 });
}

// 옵션 2: 세션 쿠키 기반 (추후 확장)
```

### 문서 보완 (P2)

- `025-traceability-matrix.md`: PRD C-020~C-031, K-001~K-012와 API 매핑
- `026-test-specification.md`: 단위 테스트, 통합 테스트 케이스 정의

---

## 결론

설계 문서의 API 명세와 유즈케이스는 충실하나, 보안(P1)과 보조 문서(P2) 보완이 필요합니다.
P1 이슈 해결 후 구현 진행을 권장합니다.

---

## 다음 단계

- `/wf:apply TSK-01-03` - 리뷰 내용 반영
- `/wf:build TSK-01-03` - 구현 시작

---

<!--
021-design-review-claude-1.md
Version: 1.0
-->
