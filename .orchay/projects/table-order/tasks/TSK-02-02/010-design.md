# TSK-02-02 - μ‹¤μ‹κ°„ μ΄λ²¤νΈ μ†΅μμ‹  κµ¬ν„ μ„¤κ³„ λ¬Έμ„

## λ¬Έμ„ μ •λ³΄

| ν•­λ© | λ‚΄μ© |
|------|------|
| Task ID | TSK-02-02 |
| λ¬Έμ„ λ²„μ „ | 1.0 |
| μ‘μ„±μΌ | 2026-01-02 |
| μƒνƒ | μ‘μ„±μ¤‘ |
| μΉ΄ν…κ³ λ¦¬ | development |

---

## 1. κ°μ”

### 1.1 λ°°κ²½ λ° λ¬Έμ  μ •μ

**ν„μ¬ μƒν™©:**
- TSK-02-01μ—μ„ Socket.io μ„λ²„ λ° Custom Server κµ¬μ„± μ™„λ£
- ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„ WebSocket μ—°κ²° μΈν”„λΌ μ¤€λΉ„λ¨
- λ£Έ κΈ°λ° μ΄λ²¤νΈ μ²λ¦¬ κµ¬μ΅° (table:{id}, kitchen) κµ¬μ¶•λ¨

**ν•΄κ²°ν•λ ¤λ” λ¬Έμ :**
- μƒ μ£Όλ¬Έ μƒμ„± μ‹ μ£Όλ°© ν™”λ©΄μ— μ‹¤μ‹κ°„ μ•λ¦Όμ΄ μ „λ‹¬λμ§€ μ•μ
- μ£Όλ°©μ—μ„ μ£Όλ¬Έ μƒνƒ λ³€κ²½ μ‹ κ³ κ° ν™”λ©΄μ— μ¦‰μ‹ λ°μλμ§€ μ•μ
- ν΄λΌμ΄μ–ΈνΈ μΈ΅ Socket.io μ—°κ²° λ° μ΄λ²¤νΈ ν•Έλ“¤λ§ λ―Έκµ¬ν„

### 1.2 λ©μ  λ° κΈ°λ€ ν¨κ³Ό

**λ©μ :**
- μ£Όλ¬Έ μƒμ„± μ‹ `order:new` μ΄λ²¤νΈλ΅ μ£Όλ°©μ— μ‹¤μ‹κ°„ μ•λ¦Ό μ „μ†΅
- μ£Όλ¬Έ μƒνƒ λ³€κ²½ μ‹ `order:status` μ΄λ²¤νΈλ΅ κ³ κ°μ— μ‹¤μ‹κ°„ μ•λ¦Ό μ „μ†΅
- ν΄λΌμ΄μ–ΈνΈ μΈ΅ Socket.io ν›…/μ ν‹Έ κµ¬ν„

**κΈ°λ€ ν¨κ³Ό:**
- κ³ κ°: μ£Όλ¬Έ μƒνƒλ¥Ό μƒλ΅κ³ μΉ¨ μ—†μ΄ μ‹¤μ‹κ°„μΌλ΅ ν™•μΈ κ°€λ¥
- μ£Όλ°©: μƒ μ£Όλ¬Έ μ¦‰μ‹ μμ‹ μΌλ΅ λΉ λ¥Έ λ€μ‘ κ°€λ¥
- λΉ„μ¦λ‹μ¤: μ£Όλ¬Έ-μ΅°λ¦¬ ν”„λ΅μ„Έμ¤ ν¨μ¨ν™”, κ³ κ° λ§μ΅±λ„ ν–¥μƒ

### 1.3 λ²”μ„

**ν¬ν•¨:**
- `order:new` μ΄λ²¤νΈ κµ¬ν„ (μ„λ²„ β†’ μ£Όλ°©)
- `order:status` μ΄λ²¤νΈ κµ¬ν„ (μ„λ²„ β†’ κ³ κ°)
- ν΄λΌμ΄μ–ΈνΈ Socket.io μ ν‹Έ/ν›… (`lib/socket.ts`)
- μ—°κ²° λκΉ€ μ‹ μ¬μ—°κ²° μ²λ¦¬

**μ μ™Έ:**
- μ£Όλ¬Έ μƒμ„± API μμ • (μ΄λ²¤νΈ λ°μ†΅ λ΅μ§ μ¶”κ°€λ§)
- μ£Όλ¬Έ μƒνƒ λ³€κ²½ API μμ • (μ΄λ²¤νΈ λ°μ†΅ λ΅μ§ μ¶”κ°€λ§)
- UI μ»΄ν¬λ„νΈ κµ¬ν„ (λ³„λ„ Task)

### 1.4 μ°Έμ΅° λ¬Έμ„

| λ¬Έμ„ | κ²½λ΅ | κ΄€λ ¨ μ„Ήμ… |
|------|------|----------|
| PRD | `.orchay/projects/table-order/prd.md` | μ„Ήμ… 5 WebSocket μ΄λ²¤νΈ |
| TRD | `.orchay/projects/table-order/trd.md` | μ„Ήμ… 5 μ‹¤μ‹κ°„ ν†µμ‹  |
| TSK-02-01 μ„¤κ³„ | `tasks/TSK-02-01/010-design.md` | Socket.io μ„λ²„ μ„¤μ • |

---

## 2. μ‚¬μ©μ λ¶„μ„

### 2.1 λ€μƒ μ‚¬μ©μ

| μ‚¬μ©μ μ ν• | νΉμ„± | μ£Όμ” λ‹μ¦ |
|------------|------|----------|
| κ³ κ° | ν…μ΄λΈ”μ—μ„ λ¨λ°”μΌλ΅ μ£Όλ¬Έ, κΈ°μ  μμ¤€ λ‹¤μ–‘ | μ£Όλ¬Έ μƒνƒλ¥Ό μ¦‰μ‹ μ•κ³  μ‹¶μ |
| μ£Όλ°© | KDS ν™”λ©΄ μ‚¬μ©, λΉ λ¥Έ μ£Όλ¬Έ ν™•μΈ ν•„μ” | μƒ μ£Όλ¬Έ λ†“μΉμ§€ μ•κ³  λ°”λ΅ ν™•μΈ |

### 2.2 μ‚¬μ©μ νλ¥΄μ†λ‚

**νλ¥΄μ†λ‚ 1: κ³ κ° κΉ€λ―Όμ**
- μ—­ν• : μ‹λ‹Ή κ³ κ°
- λ©ν‘: μ£Όλ¬Έ ν›„ μ΅°λ¦¬ μƒνƒλ¥Ό μ‹¤μ‹κ°„μΌλ΅ μ•κ³  μ‹¶μ
- λ¶λ§: μ£Όλ¬Έμ΄ μ λ“¤μ–΄κ°”λ”μ§€, μ–Έμ  λ‚μ¤λ”μ§€ μ• μ μ—†μ
- μ‹λ‚λ¦¬μ¤: μ£Όλ¬Έ ν›„ μƒνƒ νμ΄μ§€μ—μ„ "μ΅°λ¦¬μ¤‘" ν‘μ‹ ν™•μΈ

**νλ¥΄μ†λ‚ 2: μ£Όλ°© μ§μ› λ°•μ΅°λ¦¬**
- μ—­ν• : μ£Όλ°© μ΅°λ¦¬μ‚¬
- λ©ν‘: μƒ μ£Όλ¬Έμ„ λΉ λ¥΄κ² ν™•μΈν•κ³  μ΅°λ¦¬ μ‹μ‘
- λ¶λ§: μƒ μ£Όλ¬Έμ΄ μ™”λ”μ§€ λ¨λ¥΄κ³  λ†“μΉλ” κ²½μ° λ°μƒ
- μ‹λ‚λ¦¬μ¤: μƒ μ£Όλ¬Έ μ•λ¦Όμκ³Ό ν•¨κ» KDSμ— μ£Όλ¬Έ μΉ΄λ“ ν‘μ‹

---

## 3. μ μ¦μΌ€μ΄μ¤

### 3.1 μ μ¦μΌ€μ΄μ¤ λ‹¤μ΄μ–΄κ·Έλ¨

```mermaid
flowchart LR
    subgraph μ‹μ¤ν…
        UC01[UC-01: μƒ μ£Όλ¬Έ μ‹¤μ‹κ°„ μμ‹ ]
        UC02[UC-02: μ£Όλ¬Έ μƒνƒ μ‹¤μ‹κ°„ μμ‹ ]
        UC03[UC-03: μ—°κ²° λ³µμ›]
    end

    μ£Όλ°©((μ£Όλ°©)) --> UC01
    κ³ κ°((κ³ κ°)) --> UC02
    κ³ κ° --> UC03
    μ£Όλ°© --> UC03
```

### 3.2 μ μ¦μΌ€μ΄μ¤ μƒμ„Έ

#### UC-01: μƒ μ£Όλ¬Έ μ‹¤μ‹κ°„ μμ‹ 

| ν•­λ© | λ‚΄μ© |
|------|------|
| μ•΅ν„° | μ£Όλ°© |
| λ©μ  | κ³ κ°μ΄ μ£Όλ¬Έν•λ©΄ μ£Όλ°©μ—μ„ μ¦‰μ‹ ν™•μΈ |
| μ‚¬μ „ μ΅°κ±΄ | μ£Όλ°© ν™”λ©΄μ΄ kitchen λ£Έμ— μ΅°μΈλ¨ |
| μ‚¬ν›„ μ΅°κ±΄ | μ£Όλ°© ν™”λ©΄μ— μƒ μ£Όλ¬Έ μΉ΄λ“ μ¶”κ°€, μ•λ¦Όμ μ¬μƒ |
| νΈλ¦¬κ±° | κ³ κ°μ΄ POST /api/orders νΈμ¶ |

**κΈ°λ³Έ νλ¦„:**
1. κ³ κ°μ΄ μ£Όλ¬Έν•κΈ° λ²„νΌμ„ ν΄λ¦­ν•λ‹¤
2. μ„λ²„κ°€ μ£Όλ¬Έμ„ DBμ— μ €μ¥ν•λ‹¤
3. μ„λ²„κ°€ `order:new` μ΄λ²¤νΈλ¥Ό kitchen λ£Έμ— λ°μ†΅ν•λ‹¤
4. μ£Όλ°© ν΄λΌμ΄μ–ΈνΈκ°€ μ΄λ²¤νΈλ¥Ό μμ‹ ν•λ‹¤
5. μ£Όλ°© ν™”λ©΄μ— μƒ μ£Όλ¬Έ μΉ΄λ“κ°€ ν‘μ‹λκ³  μ•λ¦Όμμ΄ μ¬μƒλλ‹¤

**μμ™Έ νλ¦„:**
- 3a. WebSocket μ—°κ²° λκΉ€:
  - μ£Όλ°©μ΄ μ¬μ—°κ²°λλ©΄ GET /api/kitchen/ordersλ΅ μµμ‹  λ©λ΅ μ΅°ν
  - λ„λ½λ μ£Όλ¬Έ μ—†μ΄ μ „μ²΄ λ™κΈ°ν™”

#### UC-02: μ£Όλ¬Έ μƒνƒ μ‹¤μ‹κ°„ μμ‹ 

| ν•­λ© | λ‚΄μ© |
|------|------|
| μ•΅ν„° | κ³ κ° |
| λ©μ  | μ£Όλ°©μ—μ„ μƒνƒ λ³€κ²½ μ‹ κ³ κ°μ΄ μ¦‰μ‹ ν™•μΈ |
| μ‚¬μ „ μ΅°κ±΄ | κ³ κ° ν™”λ©΄μ΄ table:{id} λ£Έμ— μ΅°μΈλ¨ |
| μ‚¬ν›„ μ΅°κ±΄ | κ³ κ° ν™”λ©΄μ— λ³€κ²½λ μƒνƒ ν‘μ‹ |
| νΈλ¦¬κ±° | μ£Όλ°©μ΄ PATCH /api/orders/{id}/status νΈμ¶ |

**κΈ°λ³Έ νλ¦„:**
1. μ£Όλ°©μ΄ μ΅°λ¦¬ μ‹μ‘/μ™„λ£ λ²„νΌμ„ ν΄λ¦­ν•λ‹¤
2. μ„λ²„κ°€ μ£Όλ¬Έ μƒνƒλ¥Ό μ—…λ°μ΄νΈν•λ‹¤
3. μ„λ²„κ°€ `order:status` μ΄λ²¤νΈλ¥Ό ν•΄λ‹Ή table:{id} λ£Έμ— λ°μ†΅ν•λ‹¤
4. κ³ κ° ν΄λΌμ΄μ–ΈνΈκ°€ μ΄λ²¤νΈλ¥Ό μμ‹ ν•λ‹¤
5. κ³ κ° ν™”λ©΄μ μ£Όλ¬Έ μƒνƒ λ°°μ§€κ°€ μ—…λ°μ΄νΈλλ‹¤

**μμ™Έ νλ¦„:**
- 3a. WebSocket μ—°κ²° λκΉ€:
  - κ³ κ°μ΄ μ¬μ—°κ²°λλ©΄ GET /api/orders?table={id}λ΅ μµμ‹  μƒνƒ μ΅°ν

#### UC-03: μ—°κ²° λ³µμ›

| ν•­λ© | λ‚΄μ© |
|------|------|
| μ•΅ν„° | κ³ κ°, μ£Όλ°© |
| λ©μ  | μ—°κ²° λκΉ€ ν›„ μλ™ μ¬μ—°κ²° λ° λ°μ΄ν„° λ™κΈ°ν™” |
| μ‚¬μ „ μ΅°κ±΄ | WebSocket μ—°κ²°μ΄ λμ–΄μ§„ μƒνƒ |
| μ‚¬ν›„ μ΅°κ±΄ | μ—°κ²° λ³µμ›, κΈ°μ΅΄ λ£Έ μ¬μ΅°μΈ, μµμ‹  λ°μ΄ν„° μ΅°ν |
| νΈλ¦¬κ±° | λ„¤νΈμ›ν¬ λ³µμ› λλ” νμ΄μ§€ ν¬μ»¤μ¤ |

**κΈ°λ³Έ νλ¦„:**
1. Socket.io ν΄λΌμ΄μ–ΈνΈκ°€ μλ™ μ¬μ—°κ²° μ‹λ„
2. μ—°κ²° μ„±κ³µ μ‹ κΈ°μ΅΄ λ£Έμ— λ‹¤μ‹ μ΅°μΈ
3. ν•΄λ‹Ή ν™”λ©΄μ μµμ‹  λ°μ΄ν„° API μ΅°ν
4. UI μƒνƒ λ™κΈ°ν™”

---

## 4. μ‚¬μ©μ μ‹λ‚λ¦¬μ¤

### 4.1 μ‹λ‚λ¦¬μ¤ 1: κ³ κ° μ£Όλ¬Έ β†’ μ£Όλ°© μμ‹ 

**μƒν™© μ„¤λ…:**
κ³ κ°μ΄ 5λ² ν…μ΄λΈ”μ—μ„ κΉ€μΉμ°κ° 2κ°λ¥Ό μ£Όλ¬Έν•©λ‹λ‹¤. μ£Όλ°©μ—μ„λ” KDS ν™”λ©΄μ„ λ³΄κ³  μμµλ‹λ‹¤.

**λ‹¨κ³„λ³„ μ§„ν–‰:**

| λ‹¨κ³„ | μ‚¬μ©μ ν–‰λ™ | μ‹μ¤ν… λ°μ‘ | μ‚¬μ©μ κΈ°λ€ |
|------|-----------|------------|------------|
| 1 | κ³ κ°μ΄ μ£Όλ¬Έν•κΈ° λ²„νΌ ν΄λ¦­ | POST /api/orders νΈμ¶ | μ£Όλ¬Έ μ „μ†΅λ¨ |
| 2 | - | μ„λ²„κ°€ order:new μ΄λ²¤νΈ λ°μ†΅ | - |
| 3 | μ£Όλ°©μ΄ KDS ν™”λ©΄ ν™•μΈ | μ•λ¦Όμ μ¬μƒ, μƒ μ£Όλ¬Έ μΉ΄λ“ ν‘μ‹ | μƒ μ£Όλ¬Έ μ¦‰μ‹ ν™•μΈ |

**μ„±κ³µ μ΅°κ±΄:**
- μ£Όλ¬Έ μƒμ„± ν›„ 1μ΄ μ΄λ‚΄ μ£Όλ°© ν™”λ©΄μ— ν‘μ‹
- μ•λ¦Όμ μ¬μƒλ¨

### 4.2 μ‹λ‚λ¦¬μ¤ 2: μ£Όλ°© μƒνƒ λ³€κ²½ β†’ κ³ κ° μμ‹ 

**μƒν™© μ„¤λ…:**
μ£Όλ°©μ—μ„ 5λ² ν…μ΄λΈ” μ£Όλ¬Έμ μ΅°λ¦¬λ¥Ό μ‹μ‘ν•©λ‹λ‹¤. κ³ κ°μ€ μƒνƒ ν™•μΈ νμ΄μ§€λ¥Ό λ³΄κ³  μμµλ‹λ‹¤.

**λ‹¨κ³„λ³„ μ§„ν–‰:**

| λ‹¨κ³„ | μ‚¬μ©μ ν–‰λ™ | μ‹μ¤ν… λ°μ‘ | μ‚¬μ©μ κΈ°λ€ |
|------|-----------|------------|------------|
| 1 | μ£Όλ°©μ΄ μ΅°λ¦¬μ‹μ‘ λ²„νΌ ν΄λ¦­ | PATCH /api/orders/{id}/status νΈμ¶ | μƒνƒ λ³€κ²½λ¨ |
| 2 | - | μ„λ²„κ°€ order:status μ΄λ²¤νΈ λ°μ†΅ | - |
| 3 | κ³ κ°μ΄ μƒνƒ νμ΄μ§€ ν™•μΈ | StatusBadgeκ°€ "μ΅°λ¦¬μ¤‘"μΌλ΅ λ³€κ²½ | μƒνƒ μ¦‰μ‹ ν™•μΈ |

**μ„±κ³µ μ΅°κ±΄:**
- μƒνƒ λ³€κ²½ ν›„ 1μ΄ μ΄λ‚΄ κ³ κ° ν™”λ©΄μ— λ°μ
- μƒλ΅κ³ μΉ¨ μ—†μ΄ μλ™ μ—…λ°μ΄νΈ

### 4.3 μ‹λ‚λ¦¬μ¤ 3: μ—°κ²° λκΉ€ λ³µκµ¬

**μƒν™© μ„¤λ…:**
κ³ κ°μ΄ μƒνƒ νμ΄μ§€λ¥Ό λ³΄λ‹¤κ°€ μΌμ‹μ μΌλ΅ λ„¤νΈμ›ν¬κ°€ λκ²Όλ‹¤κ°€ λ³µμ›λ©λ‹λ‹¤.

**λ‹¨κ³„λ³„ μ§„ν–‰:**

| λ‹¨κ³„ | μ‚¬μ©μ ν–‰λ™ | μ‹μ¤ν… λ°μ‘ | λ³µκµ¬ λ°©λ²• |
|------|-----------|------------|----------|
| 1 | λ„¤νΈμ›ν¬ λκΉ€ | μ—°κ²° λκΉ€ μƒνƒ ν‘μ‹ (μ„ νƒ) | μλ™ μ¬μ—°κ²° μ‹λ„ |
| 2 | λ„¤νΈμ›ν¬ λ³µμ› | μ¬μ—°κ²° μ„±κ³µ, λ£Έ μ¬μ΅°μΈ | μµμ‹  λ°μ΄ν„° API μ΅°ν |
| 3 | - | UI μƒνƒ λ™κΈ°ν™” | λ†“μΉ μ΄λ²¤νΈ μ—†μ΄ μµμ‹  μƒνƒ ν‘μ‹ |

---

## 5. ν™”λ©΄ μ„¤κ³„

> μ΄ Taskλ” ν΄λΌμ΄μ–ΈνΈ μ ν‹Έ/ν›… κµ¬ν„μ΄ μ£Όμ” λ²”μ„μ…λ‹λ‹¤.
> ν™”λ©΄ UIλ” TSK-03-03 (κ³ κ° μƒνƒ νμ΄μ§€), TSK-04-01 (μ£Όλ°© KDS)μ—μ„ κµ¬ν„ν•©λ‹λ‹¤.

### 5.1 ν΄λΌμ΄μ–ΈνΈ μ—°κ²° μƒνƒ ν‘μ‹ (μ„ νƒ)

**μ—°κ²° μƒνƒ μΈλ””μΌ€μ΄ν„°:**
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  πΆ μ‹¤μ‹κ°„ μ—°κ²°λ¨    (μ—°κ²° μ‹)       β”‚
β”‚  π΅ μ—°κ²° μ¤‘...      (μ¬μ—°κ²° μ‹λ„)    β”‚
β”‚  π”΄ μ—°κ²° λκΉ€       (μ¤ν”„λΌμΈ)       β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

> μ—°κ²° μƒνƒ ν‘μ‹λ” μ„ νƒ μ‚¬ν•­μ΄λ©°, UI κµ¬ν„ Taskμ—μ„ μ¶”κ°€ κ°€λ¥ν•©λ‹λ‹¤.

---

## 6. μΈν„°λ™μ… μ„¤κ³„

### 6.1 μ΄λ²¤νΈ ν”λ΅μ°

```mermaid
sequenceDiagram
    participant C as κ³ κ°
    participant S as μ„λ²„
    participant K as μ£Όλ°©

    Note over C,K: μƒ μ£Όλ¬Έ ν”λ΅μ°
    C->>S: POST /api/orders
    S->>S: DB μ €μ¥
    S->>K: order:new (kitchen λ£Έ)
    K->>K: μ£Όλ¬Έ μΉ΄λ“ μ¶”κ°€ + μ•λ¦Όμ

    Note over C,K: μƒνƒ λ³€κ²½ ν”λ΅μ°
    K->>S: PATCH /api/orders/{id}/status
    S->>S: DB μ—…λ°μ΄νΈ
    S->>C: order:status (table:{id} λ£Έ)
    C->>C: StatusBadge μ—…λ°μ΄νΈ
```

### 6.2 μ΄λ²¤νΈ νμ΄λ΅λ“

#### order:new μ΄λ²¤νΈ

```typescript
interface OrderNewEvent {
  orderId: number;
  tableNumber: number;
  items: {
    menuId: number;
    menuName: string;
    quantity: number;
  }[];
  createdAt: string; // ISO 8601
}
```

#### order:status μ΄λ²¤νΈ

```typescript
interface OrderStatusEvent {
  orderId: number;
  status: 'pending' | 'cooking' | 'completed';
  updatedAt: string; // ISO 8601
}
```

### 6.3 μ¬μ—°κ²° μ²λ¦¬

| μƒνƒ | μ²λ¦¬ | API νΈμ¶ |
|------|------|----------|
| μ£Όλ°© μ¬μ—°κ²° | kitchen λ£Έ μ¬μ΅°μΈ | GET /api/kitchen/orders |
| κ³ κ° μ¬μ—°κ²° | table:{id} λ£Έ μ¬μ΅°μΈ | GET /api/orders?table={id} |

---

## 7. λ°μ΄ν„° μ”κµ¬μ‚¬ν•­

### 7.1 ν•„μ”ν• λ°μ΄ν„°

| λ°μ΄ν„° | μ„¤λ… | μ¶μ² | μ©λ„ |
|--------|------|------|------|
| orderId | μ£Όλ¬Έ ID | μ£Όλ¬Έ μƒμ„± API μ‘λ‹µ | μ΄λ²¤νΈ μ‹λ³„ |
| tableNumber | ν…μ΄λΈ” λ²νΈ | orders.table_id β†’ tables.table_number | μ£Όλ¬Έ ν‘μ‹ |
| items | μ£Όλ¬Έ ν•­λ© | order_items + menus | μ£Όλ¬Έ μƒμ„Έ ν‘μ‹ |
| status | μ£Όλ¬Έ μƒνƒ | orders.status | μƒνƒ λ°°μ§€ ν‘μ‹ |

### 7.2 ν΄λΌμ΄μ–ΈνΈ μƒνƒ κ΄€λ¦¬

```typescript
// μ£Όλ°© ν™”λ©΄ μƒνƒ
interface KitchenState {
  orders: Order[];
  isConnected: boolean;
}

// κ³ κ° μƒνƒ ν™”λ©΄ μƒνƒ
interface CustomerStatusState {
  orders: Order[];
  tableId: number;
  isConnected: boolean;
}
```

---

## 8. λΉ„μ¦λ‹μ¤ κ·μΉ™

### 8.1 ν•µμ‹¬ κ·μΉ™

| κ·μΉ™ ID | κ·μΉ™ μ„¤λ… | μ μ© μƒν™© | μμ™Έ |
|---------|----------|----------|------|
| BR-01 | μ£Όλ¬Έ μƒμ„± μ‹ μ¦‰μ‹ μ£Όλ°©μ— μ•λ¦Ό | POST /api/orders μ„±κ³µ μ‹ | μ—†μ |
| BR-02 | μƒνƒ λ³€κ²½ μ‹ ν•΄λ‹Ή ν…μ΄λΈ”μ—λ§ μ•λ¦Ό | PATCH /api/orders/{id}/status μ„±κ³µ μ‹ | μ—†μ |
| BR-03 | μ™„λ£λ μ£Όλ¬Έλ„ μƒνƒ μ΄λ²¤νΈ λ°μ†΅ | completed μƒνƒ λ³€κ²½ μ‹ | μ—†μ |

### 8.2 κ·μΉ™ μƒμ„Έ μ„¤λ…

**BR-01: μ£Όλ¬Έ μƒμ„± μ¦‰μ‹ μ•λ¦Ό**

μ„¤λ…: κ³ κ°μ΄ μ£Όλ¬Έν•λ©΄ μ£Όλ°©μ΄ μ¦‰μ‹ ν™•μΈν•  μ μμ–΄μ•Ό ν•©λ‹λ‹¤. μ£Όλ¬Έ API μ„±κ³µ ν›„ λ°λ“μ‹ `order:new` μ΄λ²¤νΈλ¥Ό λ°μ†΅ν•΄μ•Ό ν•©λ‹λ‹¤.

**BR-02: ν…μ΄λΈ”λ³„ μ•λ¦Ό**

μ„¤λ…: μƒνƒ λ³€κ²½ μ•λ¦Όμ€ ν•΄λ‹Ή μ£Όλ¬Έμ ν…μ΄λΈ” λ£Έμ—λ§ λ°μ†΅ν•©λ‹λ‹¤. λ‹¤λ¥Έ ν…μ΄λΈ” κ³ κ°μ—κ²λ” μ „λ‹¬λμ§€ μ•μµλ‹λ‹¤.

---

## 9. μ—λ¬ μ²λ¦¬

### 9.1 μμƒ μ—λ¬ μƒν™©

| μƒν™© | μ›μΈ | μ‚¬μ©μ λ©”μ‹μ§€ | λ³µκµ¬ λ°©λ²• |
|------|------|--------------|----------|
| μ—°κ²° μ‹¤ν¨ | μ„λ²„ λ‹¤μ΄, λ„¤νΈμ›ν¬ λ¬Έμ  | "μ„λ²„ μ—°κ²° μ¤‘..." | μλ™ μ¬μ—°κ²° μ‹λ„ |
| μ΄λ²¤νΈ μμ‹  μ‹¤ν¨ | μ—°κ²° λκΉ€ μ¤‘ μ΄λ²¤νΈ λ°μƒ | - | μ¬μ—°κ²° μ‹ API μ¬μ΅°ν |
| λ£Έ μ΅°μΈ μ‹¤ν¨ | μλ»λ tableId | μ½μ†” κ²½κ³  | νμ΄μ§€ μƒλ΅κ³ μΉ¨ |

### 9.2 μ—λ¬ ν‘μ‹ λ°©μ‹

| μ—λ¬ μ ν• | ν‘μ‹ μ„μΉ | ν‘μ‹ λ°©λ²• |
|----------|----------|----------|
| μ—°κ²° λκΉ€ | ν™”λ©΄ μƒλ‹¨ (μ„ νƒ) | μ—°κ²° μƒνƒ μΈλ””μΌ€μ΄ν„° |
| μ¬μ—°κ²° μ‹λ„ | ν™”λ©΄ μƒλ‹¨ (μ„ νƒ) | "μ—°κ²° μ¤‘..." ν‘μ‹ |

---

## 10. μ—°κ΄€ λ¬Έμ„

| λ¬Έμ„ | κ²½λ΅ | μ©λ„ |
|------|------|------|
| μ”κµ¬μ‚¬ν•­ μ¶”μ  λ§¤νΈλ¦­μ¤ | `025-traceability-matrix.md` | PRD β†’ μ„¤κ³„ β†’ ν…μ¤νΈ μ¶”μ  |
| ν…μ¤νΈ λ…μ„Έμ„ | `026-test-specification.md` | λ‹¨μ„/E2E/λ§¤λ‰΄μ–Ό ν…μ¤νΈ μ •μ |

---

## 11. κµ¬ν„ λ²”μ„

### 11.1 μν–¥λ°›λ” μμ—­

| μμ—­ | λ³€κ²½ λ‚΄μ© | μν–¥λ„ |
|------|----------|--------|
| lib/socket.ts | Socket.io ν΄λΌμ΄μ–ΈνΈ μ ν‹Έ μƒμ„± | λ†’μ |
| api/orders/route.ts | order:new μ΄λ²¤νΈ λ°μ†΅ μ¶”κ°€ | μ¤‘κ°„ |
| api/orders/[id]/status/route.ts | order:status μ΄λ²¤νΈ λ°μ†΅ μ¶”κ°€ | μ¤‘κ°„ |
| server.ts | io μΈμ¤ν„΄μ¤ export μ¶”κ°€ | λ‚®μ |

### 11.2 μμ΅΄μ„±

| μμ΅΄ ν•­λ© | μ΄μ  | μƒνƒ |
|----------|------|------|
| TSK-02-01 | Socket.io μ„λ²„ μ„¤μ • | μ™„λ£ λ€κΈ° |
| TSK-01-03 | μ£Όλ¬Έ API | μ™„λ£ λ€κΈ° |

### 11.3 μ μ•½ μ‚¬ν•­

| μ μ•½ | μ„¤λ… | λ€μ‘ λ°©μ• |
|------|------|----------|
| Socket.io μΈμ¤ν„΄μ¤ κ³µμ  | API λΌμ°νΈμ—μ„ io μΈμ¤ν„΄μ¤ μ ‘κ·Ό ν•„μ” | μ „μ—­ μ‹±κΈ€ν†¤ λλ” context ν™μ© |
| Next.js API Routes μ ν• | WebSocket μ§μ ‘ μ‚¬μ© λ¶κ°€ | Custom Server ν™μ© |

---

## 12. κΈ°μ  μƒμ„Έ

### 12.1 ν΄λΌμ΄μ–ΈνΈ Socket.io μ ν‹Έ

```typescript
// lib/socket.ts
import { io, Socket } from 'socket.io-client';

let socket: Socket | null = null;

export function getSocket(): Socket {
  if (!socket) {
    socket = io({
      path: '/socket.io',
      autoConnect: true,
      reconnection: true,
      reconnectionAttempts: Infinity,
      reconnectionDelay: 1000,
      reconnectionDelayMax: 5000,
    });
  }
  return socket;
}

export function joinTable(tableId: number): void {
  const socket = getSocket();
  socket.emit('join:table', tableId);
}

export function joinKitchen(): void {
  const socket = getSocket();
  socket.emit('join:kitchen');
}

export function onOrderNew(callback: (data: OrderNewEvent) => void): () => void {
  const socket = getSocket();
  socket.on('order:new', callback);
  return () => socket.off('order:new', callback);
}

export function onOrderStatus(callback: (data: OrderStatusEvent) => void): () => void {
  const socket = getSocket();
  socket.on('order:status', callback);
  return () => socket.off('order:status', callback);
}

export function onConnect(callback: () => void): () => void {
  const socket = getSocket();
  socket.on('connect', callback);
  return () => socket.off('connect', callback);
}

export function onDisconnect(callback: () => void): () => void {
  const socket = getSocket();
  socket.on('disconnect', callback);
  return () => socket.off('disconnect', callback);
}
```

### 12.2 μ„λ²„ μ΄λ²¤νΈ λ°μ†΅

```typescript
// server.ts μμ • - io μΈμ¤ν„΄μ¤ export
import { Server as SocketIOServer } from 'socket.io';

export let io: SocketIOServer | null = null;

// μ„λ²„ μ΄κΈ°ν™” μ‹
io = new Server(server);

// api/orders/route.tsμ—μ„ μ‚¬μ©
import { io } from '@/server';

// POST /api/orders ν•Έλ“¤λ¬ λ‚΄λ¶€
if (io) {
  io.to('kitchen').emit('order:new', {
    orderId: result.lastInsertRowid,
    tableNumber,
    items,
    createdAt: new Date().toISOString(),
  });
}

// api/orders/[id]/status/route.tsμ—μ„ μ‚¬μ©
// PATCH ν•Έλ“¤λ¬ λ‚΄λ¶€
if (io) {
  io.to(`table:${tableId}`).emit('order:status', {
    orderId: id,
    status,
    updatedAt: new Date().toISOString(),
  });
}
```

### 12.3 React ν›… (μ„ νƒ)

```typescript
// hooks/useSocket.ts
import { useEffect, useState, useCallback } from 'react';
import { getSocket, joinTable, joinKitchen, onOrderNew, onOrderStatus, onConnect, onDisconnect } from '@/lib/socket';
import type { OrderNewEvent, OrderStatusEvent } from '@/types';

export function useKitchenSocket(onNewOrder: (data: OrderNewEvent) => void) {
  const [isConnected, setIsConnected] = useState(false);

  useEffect(() => {
    joinKitchen();

    const unsubConnect = onConnect(() => setIsConnected(true));
    const unsubDisconnect = onDisconnect(() => setIsConnected(false));
    const unsubNewOrder = onOrderNew(onNewOrder);

    return () => {
      unsubConnect();
      unsubDisconnect();
      unsubNewOrder();
    };
  }, [onNewOrder]);

  return { isConnected };
}

export function useCustomerSocket(tableId: number, onStatusChange: (data: OrderStatusEvent) => void) {
  const [isConnected, setIsConnected] = useState(false);

  useEffect(() => {
    joinTable(tableId);

    const unsubConnect = onConnect(() => setIsConnected(true));
    const unsubDisconnect = onDisconnect(() => setIsConnected(false));
    const unsubStatus = onOrderStatus(onStatusChange);

    return () => {
      unsubConnect();
      unsubDisconnect();
      unsubStatus();
    };
  }, [tableId, onStatusChange]);

  return { isConnected };
}
```

---

## 13. μ²΄ν¬λ¦¬μ¤νΈ

### 13.1 μ„¤κ³„ μ™„λ£ ν™•μΈ

- [x] λ¬Έμ  μ •μ λ° λ©μ  λ…ν™•ν™”
- [x] μ‚¬μ©μ λ¶„μ„ μ™„λ£
- [x] μ μ¦μΌ€μ΄μ¤ μ •μ μ™„λ£
- [x] μ‚¬μ©μ μ‹λ‚λ¦¬μ¤ μ‘μ„± μ™„λ£
- [x] μΈν„°λ™μ… μ„¤κ³„ μ™„λ£
- [x] λ°μ΄ν„° μ”κµ¬μ‚¬ν•­ μ •μ μ™„λ£
- [x] λΉ„μ¦λ‹μ¤ κ·μΉ™ μ •μ μ™„λ£
- [x] μ—λ¬ μ²λ¦¬ μ •μ μ™„λ£
- [x] κΈ°μ  μƒμ„Έ μ •μ μ™„λ£

### 13.2 μ—°κ΄€ λ¬Έμ„ μ‘μ„±

- [ ] μ”κµ¬μ‚¬ν•­ μ¶”μ  λ§¤νΈλ¦­μ¤ μ‘μ„± (β†’ `025-traceability-matrix.md`)
- [ ] ν…μ¤νΈ λ…μ„Έμ„ μ‘μ„± (β†’ `026-test-specification.md`)

### 13.3 κµ¬ν„ μ¤€λΉ„

- [x] κµ¬ν„ μ°μ„ μμ„ κ²°μ •
- [x] μμ΅΄μ„± ν™•μΈ μ™„λ£
- [x] μ μ•½ μ‚¬ν•­ κ²€ν†  μ™„λ£

---

## λ³€κ²½ μ΄λ ¥

| λ²„μ „ | μΌμ | μ‘μ„±μ | λ³€κ²½ λ‚΄μ© |
|------|------|--------|----------|
| 1.0 | 2026-01-02 | Claude | μµμ΄ μ‘μ„± |
