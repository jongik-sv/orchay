# TSK-02-02 테스트 명세서

## 문서 정보

| 항목 | 내용 |
|------|------|
| Task ID | TSK-02-02 |
| 문서 버전 | 1.0 |
| 작성일 | 2026-01-02 |

---

## 1. 단위 테스트

### UT-01: getSocket() 싱글톤 검증

| 항목 | 내용 |
|------|------|
| 대상 | `lib/socket.ts` getSocket() |
| 목적 | 싱글톤 인스턴스 반환 검증 |
| 사전 조건 | Socket.io 클라이언트 모킹 |

**테스트 케이스:**

| TC ID | 시나리오 | 기대 결과 |
|-------|---------|----------|
| UT-01-01 | getSocket() 첫 호출 | Socket 인스턴스 생성 |
| UT-01-02 | getSocket() 재호출 | 동일 인스턴스 반환 |

---

### UT-02: joinTable() 테스트

| 항목 | 내용 |
|------|------|
| 대상 | `lib/socket.ts` joinTable() |
| 목적 | 테이블 룸 조인 이벤트 발송 검증 |

**테스트 케이스:**

| TC ID | 시나리오 | 입력 | 기대 결과 |
|-------|---------|------|----------|
| UT-02-01 | 정상 조인 | tableId: 5 | `join:table` 이벤트 발송, 인자: 5 |

---

### UT-03: joinKitchen() 테스트

| 항목 | 내용 |
|------|------|
| 대상 | `lib/socket.ts` joinKitchen() |
| 목적 | 주방 룸 조인 이벤트 발송 검증 |

**테스트 케이스:**

| TC ID | 시나리오 | 기대 결과 |
|-------|---------|----------|
| UT-03-01 | 정상 조인 | `join:kitchen` 이벤트 발송 |

---

### UT-04: onOrderNew() 이벤트 리스너

| 항목 | 내용 |
|------|------|
| 대상 | `lib/socket.ts` onOrderNew() |
| 목적 | order:new 이벤트 구독 및 해제 검증 |

**테스트 케이스:**

| TC ID | 시나리오 | 기대 결과 |
|-------|---------|----------|
| UT-04-01 | 이벤트 구독 | socket.on('order:new') 호출됨 |
| UT-04-02 | 이벤트 수신 | 콜백 함수 실행됨 |
| UT-04-03 | 구독 해제 | 반환된 cleanup 함수 호출 시 socket.off() 호출됨 |

---

### UT-05: onOrderStatus() 이벤트 리스너

| 항목 | 내용 |
|------|------|
| 대상 | `lib/socket.ts` onOrderStatus() |
| 목적 | order:status 이벤트 구독 및 해제 검증 |

**테스트 케이스:**

| TC ID | 시나리오 | 기대 결과 |
|-------|---------|----------|
| UT-05-01 | 이벤트 구독 | socket.on('order:status') 호출됨 |
| UT-05-02 | 이벤트 수신 | 콜백 함수 실행됨 |
| UT-05-03 | 구독 해제 | cleanup 함수 호출 시 socket.off() 호출됨 |

---

### UT-06: 재연결 이벤트 핸들링

| 항목 | 내용 |
|------|------|
| 대상 | `lib/socket.ts` onConnect(), onDisconnect() |
| 목적 | 연결/해제 이벤트 핸들링 검증 |

**테스트 케이스:**

| TC ID | 시나리오 | 기대 결과 |
|-------|---------|----------|
| UT-06-01 | connect 이벤트 발생 | onConnect 콜백 실행됨 |
| UT-06-02 | disconnect 이벤트 발생 | onDisconnect 콜백 실행됨 |

---

### UT-07: 이벤트 페이로드 검증

| 항목 | 내용 |
|------|------|
| 대상 | validateOrderNewPayload(), validateOrderStatusPayload() |
| 목적 | 이벤트 페이로드 유효성 검증 |

**테스트 케이스:**

| TC ID | 시나리오 | 입력 | 기대 결과 |
|-------|---------|------|----------|
| UT-07-01 | 정상 OrderNewEvent | 유효한 페이로드 | true |
| UT-07-02 | items 빈 배열 | { items: [] } | false |
| UT-07-03 | quantity 0 | { quantity: 0 } | false |
| UT-07-04 | orderId 누락 | { orderId: undefined } | false |
| UT-07-05 | 정상 OrderStatusEvent | 유효한 페이로드 | true |
| UT-07-06 | 잘못된 status 값 | { status: 'invalid' } | false |

---

### UT-08: useKitchenSocket 훅

| 항목 | 내용 |
|------|------|
| 대상 | `hooks/useSocket.ts` useKitchenSocket() |
| 목적 | 주방 소켓 훅 동작 검증 |

**테스트 케이스:**

| TC ID | 시나리오 | 기대 결과 |
|-------|---------|----------|
| UT-08-01 | 마운트 시 | joinKitchen() 호출됨 |
| UT-08-02 | order:new 수신 | onNewOrder 콜백 실행됨 |
| UT-08-03 | 언마운트 시 | 이벤트 리스너 해제됨 |
| UT-08-04 | 연결 상태 | isConnected 상태 반환됨 |

---

### UT-09: useCustomerSocket 훅

| 항목 | 내용 |
|------|------|
| 대상 | `hooks/useSocket.ts` useCustomerSocket() |
| 목적 | 고객 소켓 훅 동작 검증 |

**테스트 케이스:**

| TC ID | 시나리오 | 기대 결과 |
|-------|---------|----------|
| UT-09-01 | 마운트 시 | joinTable(tableId) 호출됨 |
| UT-09-02 | order:status 수신 | onStatusChange 콜백 실행됨 |
| UT-09-03 | tableId 변경 | 새 테이블로 재조인 |
| UT-09-04 | 언마운트 시 | 이벤트 리스너 해제됨 |

---

## 2. 통합 테스트

### IT-01: 주문 생성 → order:new 이벤트 발송

| 항목 | 내용 |
|------|------|
| 대상 | POST /api/orders |
| 목적 | 주문 생성 시 WebSocket 이벤트 발송 검증 |

**테스트 절차:**

1. Socket.io 클라이언트를 kitchen 룸에 조인
2. POST /api/orders 요청
3. order:new 이벤트 수신 확인

**검증 항목:**

| 항목 | 기대 결과 |
|------|----------|
| 이벤트명 | `order:new` |
| orderId | 생성된 주문 ID |
| tableNumber | 요청한 테이블 번호 |
| items | 요청한 주문 항목 |
| createdAt | ISO 8601 형식 |

---

### IT-02: 상태 변경 → order:status 이벤트 발송

| 항목 | 내용 |
|------|------|
| 대상 | PATCH /api/orders/{id}/status |
| 목적 | 상태 변경 시 해당 테이블에만 이벤트 발송 검증 |

**테스트 절차:**

1. 테이블 5에 주문 생성
2. Socket.io 클라이언트 A를 table:5 룸에 조인
3. Socket.io 클라이언트 B를 table:3 룸에 조인
4. PATCH /api/orders/{id}/status { status: 'cooking' }
5. 클라이언트 A만 이벤트 수신 확인

**검증 항목:**

| 항목 | 기대 결과 |
|------|----------|
| 클라이언트 A | order:status 수신 |
| 클라이언트 B | 이벤트 미수신 |
| status | 'cooking' |

---

## 3. E2E 테스트

### E2E-01: 고객 주문 → 주방 실시간 수신

| 항목 | 내용 |
|------|------|
| 시나리오 | 시나리오 1 (설계 문서 4.1) |
| 목적 | 주문 생성부터 주방 화면 표시까지 전체 흐름 검증 |

**테스트 절차:**

1. 주방 화면 (KDS) 접속
2. 고객 화면에서 주문 생성
3. 주방 화면에 새 주문 표시 확인

**검증 항목:**

| 항목 | 기대 결과 |
|------|----------|
| 응답 시간 | 1초 이내 |
| 주문 내용 | 정확히 표시됨 |
| 테이블 번호 | 정확히 표시됨 |

---

### E2E-02: 주방 상태 변경 → 고객 실시간 수신

| 항목 | 내용 |
|------|------|
| 시나리오 | 시나리오 2 (설계 문서 4.2) |
| 목적 | 상태 변경부터 고객 화면 반영까지 전체 흐름 검증 |

**테스트 절차:**

1. 고객 상태 확인 화면 접속
2. 주방에서 해당 주문 상태를 'cooking'으로 변경
3. 고객 화면에 상태 변경 표시 확인

**검증 항목:**

| 항목 | 기대 결과 |
|------|----------|
| 응답 시간 | 1초 이내 |
| 상태 배지 | 'cooking' 표시 |
| 새로고침 | 불필요 |

---

### E2E-03: 연결 끊김 → 재연결 → 동기화

| 항목 | 내용 |
|------|------|
| 시나리오 | 시나리오 3 (설계 문서 4.3) |
| 목적 | 네트워크 끊김 후 복구 시 데이터 동기화 검증 |

**테스트 절차:**

1. 고객 상태 확인 화면 접속
2. 네트워크 끊김 시뮬레이션
3. 끊김 중 주방에서 상태 변경
4. 네트워크 복원
5. 고객 화면에 최신 상태 표시 확인

**검증 항목:**

| 항목 | 기대 결과 |
|------|----------|
| 재연결 | 자동 완료 |
| 상태 동기화 | 최신 상태 표시 |
| 누락 이벤트 | 없음 |

---

## 4. 수동 테스트 체크리스트

### 4.1 Socket.io 연결

- [ ] 페이지 로드 시 자동 연결
- [ ] 연결 상태 (isConnected) 정확히 반영
- [ ] 연결 끊김 시 자동 재연결 시도
- [ ] 재연결 성공 시 룸 자동 재조인

### 4.2 주방 화면

- [ ] 새 주문 수신 시 즉시 표시
- [ ] onNewOrder 콜백에 올바른 데이터 전달
- [ ] 여러 주문 연속 수신 처리

### 4.3 고객 화면

- [ ] 상태 변경 수신 시 즉시 반영
- [ ] 해당 테이블 주문만 수신
- [ ] 다른 테이블 이벤트 미수신

---

## 변경 이력

| 버전 | 일자 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-02 | Claude | 최초 작성 (리뷰 반영) |
